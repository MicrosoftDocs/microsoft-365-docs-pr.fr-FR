---
title: Récupération d’urgence SharePoint Server 2013 dans Microsoft Azure
ms.author: bcarter
author: brendacarter
manager: laurawi
ms.date: 04/17/2018
audience: ITPro
ms.topic: article
ms.service: o365-solutions
localization_priority: Normal
search.appverid:
- MET150
ms.collection: Ent_O365
f1.keywords:
- CSH
ms.custom:
- Ent_Deployment
- seo-marvel-apr2020
ms.assetid: e9d14cb2-ff28-4a18-a444-cebf891880ea
description: Cet article explique comment utiliser Azure pour créer un environnement de récupération d’urgence pour votre batterie de serveurs SharePoint local.
ms.openlocfilehash: 01a49cfa19711caa36190a795792635431dd7d04
ms.sourcegitcommit: 27b2b2e5c41934b918cac2c171556c45e36661bf
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/19/2021
ms.locfileid: "50907431"
---
# <a name="sharepoint-server-2013-disaster-recovery-in-microsoft-azure"></a><span data-ttu-id="26d6c-103">Récupération d'urgence SharePoint Server 2013 dans Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="26d6c-103">SharePoint Server 2013 Disaster Recovery in Microsoft Azure</span></span>

 <span data-ttu-id="26d6c-104">À l’aide d’Azure, vous pouvez créer un environnement de récupération d’urgence pour votre batterie de serveurs SharePoint locale.</span><span class="sxs-lookup"><span data-stu-id="26d6c-104">Using Azure, you can create a disaster-recovery environment for your on-premises SharePoint farm.</span></span> <span data-ttu-id="26d6c-105">Cet article décrit comment concevoir et implémenter cette solution.</span><span class="sxs-lookup"><span data-stu-id="26d6c-105">This article describes how to design and implement this solution.</span></span>

 <span data-ttu-id="26d6c-106">**Regardez la vidéo de présentation de la récupération d’urgence SharePoint Server 2013**</span><span class="sxs-lookup"><span data-stu-id="26d6c-106">**Watch the SharePoint Server 2013 disaster recovery overview video**</span></span>
> [!VIDEO https://www.microsoft.com/videoplayer/embed/1b73ec8f-29bd-44eb-aa3a-f7932784bfd9?autoplay=false]
  
 <span data-ttu-id="26d6c-p102">En cas d’incident dans votre environnement local SharePoint, votre priorité est de remettre rapidement le système en route. La récupération d’urgence avec SharePoint est plus rapide et plus facile lorsque vous disposez d’un environnement de sauvegarde déjà en cours d’exécution dans Microsoft Azure. Cette vidéo décrit les principaux concepts d’un environnement de basculement semi-automatique SharePoint et complète toutes les explications contenues dans cet article.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p102">When disaster strikes your SharePoint on-premises environment, your top priority is to get the system running again quickly. Disaster recovery with SharePoint is quicker and easier when you have a backup environment already running in Microsoft Azure. This video explains the main concepts of a SharePoint warm failover environment and complements the full details available in this article.</span></span>
  
<span data-ttu-id="26d6c-110">Utilisez cet article avec le modèle de solution suivant : **Récupération d'urgence SharePoint dans Microsoft Azure**.</span><span class="sxs-lookup"><span data-stu-id="26d6c-110">Use this article with the following solution model: **SharePoint Disaster Recovery in Microsoft Azure**.</span></span>
  
<span data-ttu-id="26d6c-111">[![Procédure de récupération d’urgence SharePoint vers Azure](../media/SP-DR-Azure.png)](https://go.microsoft.com/fwlink/p/?LinkId=392555)</span><span class="sxs-lookup"><span data-stu-id="26d6c-111">[![SharePoint disaster-recovery process to Azure](../media/SP-DR-Azure.png)](https://go.microsoft.com/fwlink/p/?LinkId=392555)</span></span>
  
 <span data-ttu-id="26d6c-112">[PDF](https://go.microsoft.com/fwlink/p/?LinkId=392555) |  [Visio](https://go.microsoft.com/fwlink/p/?LinkId=392554)</span><span class="sxs-lookup"><span data-stu-id="26d6c-112">[PDF](https://go.microsoft.com/fwlink/p/?LinkId=392555) |  [Visio](https://go.microsoft.com/fwlink/p/?LinkId=392554)</span></span>
  
## <a name="use-azure-infrastructure-services-for-disaster-recovery"></a><span data-ttu-id="26d6c-113">Utilisation des services d’infrastructure Azure pour la récupération d’urgence</span><span class="sxs-lookup"><span data-stu-id="26d6c-113">Use Azure Infrastructure Services for disaster recovery</span></span>

<span data-ttu-id="26d6c-p103">De nombreuses organisations n'ont pas d'environnement de récupération d'urgence pour SharePoint, dont la création et la gestion locales peuvent s'avérer coûteuses. La solution Services d'infrastructure Azure propose des options intéressantes d'environnements de récupération d'urgence plus flexibles et moins chères que les solutions locales.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p103">Many organizations do not have a disaster recovery environment for SharePoint, which can be expensive to build and maintain on-premises. Azure Infrastructure Services provides compelling options for disaster recovery environments that are more flexible and less expensive than the on-premises alternatives.</span></span>
  
<span data-ttu-id="26d6c-116">Avantages de la solution Services d'infrastructure Azure :</span><span class="sxs-lookup"><span data-stu-id="26d6c-116">The advantages for using Azure Infrastructure Services include:</span></span>
  
- <span data-ttu-id="26d6c-p104">**Moins de ressources coûteuses**: gérez et payez moins de ressources que pour les environnements de récupération d'urgence locaux. Le nombre de ressources dépend de l'environnement de récupération d'urgence choisi : à reprise progressive, semi-automatique ou automatique.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p104">**Fewer costly resources** Maintain and pay for fewer resources than on-premises disaster recovery environments. The number of resources depends on which disaster-recovery environment you choose: cold standby, warm standby, or hot standby.</span></span>
    
- <span data-ttu-id="26d6c-p105">**Flexibilité accrue des ressources**: en cas d'incident, augmentez facilement la taille des instances de votre batterie SharePoint de récupération pour répondre aux exigences de charge. Diminuez la taille des instances lorsque vous n'avez plus besoin des ressources.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p105">**Better resource flexibility** In the event of a disaster, easily scale out your recovery SharePoint farm to meet load requirements. Scale in when you no longer need the resources.</span></span>
    
- <span data-ttu-id="26d6c-121">**Réduction du nombre de centres de données nécessaires**: utilisez la solution Services d'infrastructure Azure au lieu d'investir dans un centre de données secondaire dans une autre région.</span><span class="sxs-lookup"><span data-stu-id="26d6c-121">**Lower datacenter commitment** Use Azure Infrastructure Services instead of investing in a secondary datacenter in a different region.</span></span>
    
<span data-ttu-id="26d6c-p106">Il existe des options moins complexes pour les organisations qui débutent tout juste en matière de récupération d'urgence et des options avancées pour les organisations dont les exigences en matière de résilience sont élevées. Les définitions des environnements à reprise progressive, de secours semi-automatique ou de secours automatique sont quelque peu différentes lorsque l'environnement est hébergé sur une plateforme cloud. Le tableau suivant décrit ces environnements pour la création d'une batterie de serveurs de récupération SharePoint dans Azure.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p106">There are less-complex options for organizations just getting started with disaster recovery and advanced options for organizations with high-resilience requirements. The definitions for cold, warm, and hot standby environments are a little different when the environment is hosted on a cloud platform. The following table describes these environments for building a SharePoint recovery farm in Azure.</span></span>
  
<span data-ttu-id="26d6c-125">**Tableau : Environnements de récupération**</span><span class="sxs-lookup"><span data-stu-id="26d6c-125">**Table: Recovery environments**</span></span>

|<span data-ttu-id="26d6c-126">**Type d'environnement de récupération**</span><span class="sxs-lookup"><span data-stu-id="26d6c-126">**Type of recovery environment**</span></span>|<span data-ttu-id="26d6c-127">**Description**</span><span class="sxs-lookup"><span data-stu-id="26d6c-127">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="26d6c-128">Automatique</span><span class="sxs-lookup"><span data-stu-id="26d6c-128">Hot</span></span>  <br/> |<span data-ttu-id="26d6c-129">Une batterie de secours entièrement à l’échelle est configurée, mise à jour et exécutée.</span><span class="sxs-lookup"><span data-stu-id="26d6c-129">A fully sized farm is provisioned, updated, and running on standby.</span></span>  <br/> |
|<span data-ttu-id="26d6c-130">Semi-automatique</span><span class="sxs-lookup"><span data-stu-id="26d6c-130">Warm</span></span>  <br/> |<span data-ttu-id="26d6c-131">La batterie de serveurs est créée et des machines virtuelles sont en cours d’exécution et mises à jour.</span><span class="sxs-lookup"><span data-stu-id="26d6c-131">The farm is built and virtual machines are running and updated.</span></span>  <br/> <span data-ttu-id="26d6c-132">La récupération inclut l’attachement de bases de données de contenu, la configuration des applications de service et l’analyse de contenu.</span><span class="sxs-lookup"><span data-stu-id="26d6c-132">Recovery includes attaching content databases, provisioning service applications, and crawling content.</span></span>  <br/> <span data-ttu-id="26d6c-133">La batterie de serveurs peut être une version réduite de la batterie de serveurs de production avant que la taille de ses instances soit augmentée pour prendre en charge l’intégralité de la base d’utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="26d6c-133">The farm can be a smaller version of the production farm and then scaled out to serve the full user base.</span></span>  <br/> |
|<span data-ttu-id="26d6c-134">À reprise progressive</span><span class="sxs-lookup"><span data-stu-id="26d6c-134">Cold</span></span>  <br/> |<span data-ttu-id="26d6c-135">La batterie de serveurs est entièrement créée, mais les machines virtuelles sont arrêtées.</span><span class="sxs-lookup"><span data-stu-id="26d6c-135">The farm is fully built, but the virtual machines are stopped.</span></span>  <br/> <span data-ttu-id="26d6c-136">La gestion de l’environnement consiste à démarrer les machines virtuelles de temps en temps, à appliquer des mises à jour correctives, à procéder à des mises à jour et à vérifier l’environnement.</span><span class="sxs-lookup"><span data-stu-id="26d6c-136">Maintaining the environment includes starting the virtual machines from time to time, patching, updating, and verifying the environment.</span></span>  <br/> <span data-ttu-id="26d6c-137">Démarrez l’environnement complet en cas d’incident.</span><span class="sxs-lookup"><span data-stu-id="26d6c-137">Start the full environment in the event of a disaster.</span></span>  <br/> |
   
<span data-ttu-id="26d6c-p107">Il est important d'évaluer les objectifs de temps de récupération (RTO) et les objectifs de point de récupération (RPO) de votre organisation. Ces exigences déterminent l'environnement le plus approprié pour votre organisation.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p107">It's important to evaluate your organization's Recovery Time Objectives (RTOs) and Recovery Point Objectives (RPOs). These requirements determine which environment is the most appropriate investment for your organization.</span></span>
  
<span data-ttu-id="26d6c-p108">Les instructions figurant dans cet article décrivent comment mettre en œuvre un environnement de secours semi-automatique. Vous pouvez également l’adapter à un environnement de reprise progressive malgré les procédures supplémentaires nécessaires pour la prise en charge de ce type d’environnement. Cet article ne décrit pas l’implémentation d’un environnement de secours automatique.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p108">The guidance in this article describes how to implement a warm standby environment. You can also adapt it to a cold standby environment, although you need to follow additional procedures to support this kind of environment. This article does not describe how to implement a hot standby environment.</span></span>
  
<span data-ttu-id="26d6c-143">Pour plus d’informations sur les solutions de récupération d’urgence, voir [High availability and disaster recovery concepts in SharePoint 2013](/SharePoint/administration/high-availability-and-disaster-recovery-concepts) et [Choose a disaster recovery strategy for SharePoint 2013](/SharePoint/administration/plan-for-disaster-recovery).</span><span class="sxs-lookup"><span data-stu-id="26d6c-143">For more information about disaster recovery solutions, see [High availability and disaster recovery concepts in SharePoint 2013](/SharePoint/administration/high-availability-and-disaster-recovery-concepts) and [Choose a disaster recovery strategy for SharePoint 2013](/SharePoint/administration/plan-for-disaster-recovery).</span></span>
  
## <a name="solution-description"></a><span data-ttu-id="26d6c-144">Description de la solution</span><span class="sxs-lookup"><span data-stu-id="26d6c-144">Solution description</span></span>

<span data-ttu-id="26d6c-145">La solution de récupération d’urgence de secours semi-automatique requiert l’environnement suivant :</span><span class="sxs-lookup"><span data-stu-id="26d6c-145">The warm standby disaster-recovery solution requires the following environment:</span></span>
  
- <span data-ttu-id="26d6c-146">Une batterie de serveurs de production SharePoint locale</span><span class="sxs-lookup"><span data-stu-id="26d6c-146">An on-premises SharePoint production farm</span></span>
    
- <span data-ttu-id="26d6c-147">Une batterie de serveurs de récupération SharePoint dans Azure</span><span class="sxs-lookup"><span data-stu-id="26d6c-147">A recovery SharePoint farm in Azure</span></span>
    
- <span data-ttu-id="26d6c-148">Une connexion VPN de site à site entre les deux environnements</span><span class="sxs-lookup"><span data-stu-id="26d6c-148">A site-to-site VPN connection between the two environments</span></span>
    
<span data-ttu-id="26d6c-149">Le schéma suivant illustre ces trois éléments.</span><span class="sxs-lookup"><span data-stu-id="26d6c-149">The following figure illustrates these three elements.</span></span>
  
<span data-ttu-id="26d6c-150">**Schéma : Éléments d'une solution de secours semi-automatique dans Azure**</span><span class="sxs-lookup"><span data-stu-id="26d6c-150">**Figure: Elements of a warm standby solution in Azure**</span></span>

![Éléments d’une solution de secours semi-automatique SharePoint dans Azure](../media/AZarch-AZWarmStndby.png)
  
<span data-ttu-id="26d6c-152">La copie des journaux de transaction SQL Server avec la réplication du système de fichiers DFS permet de copier les sauvegardes de base de données et les journaux de transaction vers la batterie de serveurs de récupération dans Azure :</span><span class="sxs-lookup"><span data-stu-id="26d6c-152">SQL Server log shipping with Distributed File System Replication (DFSR) is used to copy database backups and transaction logs to the recovery farm in Azure:</span></span> 
  
- <span data-ttu-id="26d6c-p109">La réplication du système de fichiers DFS transfère les journaux depuis l'environnement de production vers l'environnement de récupération. Dans un scénario WAN, la réplication DFS est plus efficace que la copie directe des journaux vers le serveur secondaire dans Azure.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p109">DFSR transfers logs from the production environment to the recovery environment. In a WAN scenario, DFSR is more efficient than shipping the logs directly to the secondary server in Azure.</span></span>
    
- <span data-ttu-id="26d6c-155">Les journaux sont relus vers SQL Server dans l'environnement de récupération dans Azure.</span><span class="sxs-lookup"><span data-stu-id="26d6c-155">Logs are replayed to the SQL Server in the recovery environment in Azure.</span></span>
    
- <span data-ttu-id="26d6c-156">N'attachez pas les bases de données de contenu SharePoint dont les journaux de transaction ont été copiés à l'environnement de récupération tant qu'aucun exercice de récupération n'a été effectué.</span><span class="sxs-lookup"><span data-stu-id="26d6c-156">You don't attach log-shipped SharePoint content databases in the recovery environment until a recovery exercise is performed.</span></span>
    
<span data-ttu-id="26d6c-157">Exécutez les étapes suivantes pour procéder à la récupération de la batterie de serveurs :</span><span class="sxs-lookup"><span data-stu-id="26d6c-157">Perform the following steps to recover the farm:</span></span>
  
1. <span data-ttu-id="26d6c-158">Arrêtez la copie des journaux de transaction.</span><span class="sxs-lookup"><span data-stu-id="26d6c-158">Stop log shipping.</span></span>
    
2. <span data-ttu-id="26d6c-159">Arrêtez d’accepter du trafic vers la batterie principale.</span><span class="sxs-lookup"><span data-stu-id="26d6c-159">Stop accepting traffic to the primary farm.</span></span>
    
3. <span data-ttu-id="26d6c-160">Relisez les journaux de transaction finaux.</span><span class="sxs-lookup"><span data-stu-id="26d6c-160">Replay the final transaction logs.</span></span>
    
4. <span data-ttu-id="26d6c-161">Attachez les bases de données de contenu à la batterie de serveurs.</span><span class="sxs-lookup"><span data-stu-id="26d6c-161">Attach the content databases to the farm.</span></span>
    
5. <span data-ttu-id="26d6c-162">Restaurez les applications de service à partir de bases de données de services répliquées.</span><span class="sxs-lookup"><span data-stu-id="26d6c-162">Restore service applications from the replicated services databases.</span></span>
    
6. <span data-ttu-id="26d6c-163">Mettez à jour les enregistrements du système DNS pour qu’ils pointent vers la batterie de serveurs de récupération.</span><span class="sxs-lookup"><span data-stu-id="26d6c-163">Update Domain Name System (DNS) records to point to the recovery farm.</span></span>
    
7. <span data-ttu-id="26d6c-164">Démarrez une analyse complète.</span><span class="sxs-lookup"><span data-stu-id="26d6c-164">Start a full crawl.</span></span>
    
<span data-ttu-id="26d6c-p110">Il est recommandé de reproduire ces étapes régulièrement et de les consigner pour vous assurer que votre restauration se déroulera sans accroc. L’attachement des bases de données de contenu et la restauration des applications de service sont des actions qui peuvent prendre du temps et qui impliquent généralement une configuration manuelle.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p110">We recommend that you rehearse these steps regularly and document them to help ensure that your live recovery runs smoothly. Attaching content databases and restoring service applications can take some time and typically involves some manual configuration.</span></span>
  
<span data-ttu-id="26d6c-167">Après l’exécution d’une récupération, cette solution fournit les éléments répertoriés dans le tableau suivant.</span><span class="sxs-lookup"><span data-stu-id="26d6c-167">After a recovery is performed, this solution provides the items listed in the following table.</span></span>
  
<span data-ttu-id="26d6c-168">**Tableau : Objectifs de récupération de la solution**</span><span class="sxs-lookup"><span data-stu-id="26d6c-168">**Table: Solution recovery objectives**</span></span>

|<span data-ttu-id="26d6c-169">**Élément**</span><span class="sxs-lookup"><span data-stu-id="26d6c-169">**Item**</span></span>|<span data-ttu-id="26d6c-170">**Description**</span><span class="sxs-lookup"><span data-stu-id="26d6c-170">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="26d6c-171">Sites et contenu</span><span class="sxs-lookup"><span data-stu-id="26d6c-171">Sites and content</span></span>  <br/> |<span data-ttu-id="26d6c-172">Les sites et le contenu sont disponibles dans l’environnement de récupération.</span><span class="sxs-lookup"><span data-stu-id="26d6c-172">Sites and content are available in the recovery environment.</span></span>  <br/> |
|<span data-ttu-id="26d6c-173">Nouvelle instance de recherche</span><span class="sxs-lookup"><span data-stu-id="26d6c-173">A new instance of search</span></span>  <br/> |<span data-ttu-id="26d6c-p111">Dans cette solution de secours semi-automatique, la recherche n’est pas restaurée à partir des bases de données de recherche. Les composants de recherche de la batterie de serveurs de récupération sont configurés de la même façon que dans la batterie de serveurs de production, dans la mesure du possible. Une fois les sites et le contenu restaurés, une analyse complète est exécutée pour recréer l’index de recherche. Il est inutile d’attendre que l’analyse soit terminée pour rendre les sites et le contenu disponibles.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p111">In this warm standby solution, search is not restored from search databases. Search components in the recovery farm are configured as similarly as possible to the production farm. After the sites and content are restored, a full crawl is started to rebuild the search index. You do not need to wait for the crawl to complete to make the sites and content available.</span></span>  <br/> |
|<span data-ttu-id="26d6c-178">Services</span><span class="sxs-lookup"><span data-stu-id="26d6c-178">Services</span></span>  <br/> | <span data-ttu-id="26d6c-p112">Les services qui stockent des données dans des bases de données sont restaurés à partir des bases de données dont les journaux de transaction ont été copiés. Les services qui ne stockent pas les données dans des bases de données sont simplement démarrés.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p112">Services that store data in databases are restored from the log-shipped databases. Services that do not store data in databases are simply started.</span></span> <br/>  <span data-ttu-id="26d6c-p113">Il n’est pas nécessaire de restaurer tous les services dotés de bases de données. Par exemple, il n’est pas nécessaire de restaurer les services suivants à partir des bases de données, qui peuvent simplement être démarrés après le basculement :</span><span class="sxs-lookup"><span data-stu-id="26d6c-p113">Not all services with databases need to be restored. The following services do not need to be restored from databases and can simply be started after failover:</span></span> <br/>  <span data-ttu-id="26d6c-183">Collecte de données relatives à l’utilisation et à l’état</span><span class="sxs-lookup"><span data-stu-id="26d6c-183">Usage and Health Data Collection</span></span> <br/>  <span data-ttu-id="26d6c-184">Service d’états temporaires</span><span class="sxs-lookup"><span data-stu-id="26d6c-184">State service</span></span> <br/>  <span data-ttu-id="26d6c-185">Word Automation</span><span class="sxs-lookup"><span data-stu-id="26d6c-185">Word automation</span></span> <br/>  <span data-ttu-id="26d6c-186">Tous les autres services qui n'utilisent pas de base de données</span><span class="sxs-lookup"><span data-stu-id="26d6c-186">Any other service that doesn't use a database</span></span> <br/> |
   
<span data-ttu-id="26d6c-p114">Vous pouvez recourir aux services de conseil Microsoft (MCS) ou un partenaire pour répondre à des objectifs de récupération plus complexes. Ces derniers sont indiqués dans le tableau suivant.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p114">You can work with Microsoft Consulting Services (MCS) or a partner to address more-complex recovery objectives. These are summarized in the following table.</span></span>
  
<span data-ttu-id="26d6c-189">**Tableau : Autres éléments pouvant être traités par MCS ou un partenaire**</span><span class="sxs-lookup"><span data-stu-id="26d6c-189">**Table: Other items that can be addressed by MCS or a partner**</span></span>

|<span data-ttu-id="26d6c-190">**Élément**</span><span class="sxs-lookup"><span data-stu-id="26d6c-190">**Item**</span></span>|<span data-ttu-id="26d6c-191">**Description**</span><span class="sxs-lookup"><span data-stu-id="26d6c-191">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="26d6c-192">Synchronisation des solutions de batterie de serveurs personnalisée</span><span class="sxs-lookup"><span data-stu-id="26d6c-192">Synchronizing custom farm solutions</span></span>  <br/> |<span data-ttu-id="26d6c-p115">Idéalement, la configuration de la batterie de serveurs de récupération est identique à celle de la batterie de serveurs de production. Vous pouvez faire appel à un consultant ou un partenaire afin d’évaluer si les solutions de batterie de serveurs personnalisées sont répliquées ou non et si le processus de synchronisation des deux environnements est en place.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p115">Ideally, the recovery farm configuration is identical to the production farm. You can work with a consultant or partner to evaluate whether custom farm solutions are replicated and whether the process is in place for keeping the two environments synchronized.</span></span>  <br/> |
|<span data-ttu-id="26d6c-195">Connexions aux données sources locales</span><span class="sxs-lookup"><span data-stu-id="26d6c-195">Connections to data sources on-premises</span></span>  <br/> |<span data-ttu-id="26d6c-196">Il peut s’avérer peu pratique de répliquer les connexions aux systèmes de données de serveurs principaux, telles que les connexions du contrôleur secondaire de domaine et les sources de contenu de recherche.</span><span class="sxs-lookup"><span data-stu-id="26d6c-196">It might not be practical to replicate connections to back-end data systems, such as backup domain controller (BDC) connections and search content sources.</span></span>  <br/> |
|<span data-ttu-id="26d6c-197">Scénarios de restauration de recherche</span><span class="sxs-lookup"><span data-stu-id="26d6c-197">Search restore scenarios</span></span>  <br/> |<span data-ttu-id="26d6c-p116">Étant donné que les déploiements de recherche d’entreprise ont tendance à être relativement complexes et uniques, la restauration de la recherche à partir de bases de données nécessite un plus grand investissement. Vous pouvez faire appel à un consultant ou un partenaire pour identifier et implémenter les scénarios de restauration de recherche dont votre organisation peut avoir besoin.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p116">Because enterprise search deployments tend to be fairly unique and complex, restoring search from databases requires a greater investment. You can work with a consultant or partner to identify and implement search restore scenarios that your organization might require.</span></span>  <br/> |
   
<span data-ttu-id="26d6c-200">Les instructions fournies dans cet article partent du principe que la batterie de serveurs locale est déjà conçue et déployée.</span><span class="sxs-lookup"><span data-stu-id="26d6c-200">The guidance provided in this article assumes that the on-premises farm is already designed and deployed.</span></span>
  
## <a name="detailed-architecture"></a><span data-ttu-id="26d6c-201">Architecture détaillée</span><span class="sxs-lookup"><span data-stu-id="26d6c-201">Detailed architecture</span></span>

<span data-ttu-id="26d6c-202">Idéalement, la configuration de la batterie de serveurs de récupération dans Azure est identique à celle de la batterie de serveurs de production locale. Elle doit avoir :</span><span class="sxs-lookup"><span data-stu-id="26d6c-202">Ideally, the recovery farm configuration in Azure is identical to the production farm on-premises, including the following:</span></span>
  
- <span data-ttu-id="26d6c-203">La même représentation des rôles serveur</span><span class="sxs-lookup"><span data-stu-id="26d6c-203">The same representation of server roles</span></span>
    
- <span data-ttu-id="26d6c-204">La même configuration des personnalisations</span><span class="sxs-lookup"><span data-stu-id="26d6c-204">The same configuration of customizations</span></span>
    
- <span data-ttu-id="26d6c-205">La même configuration des composants de recherche</span><span class="sxs-lookup"><span data-stu-id="26d6c-205">The same configuration of search components</span></span>
    
<span data-ttu-id="26d6c-p117">L'environnement dans Azure peut être une version réduite de la batterie de serveurs de production. Si vous envisagez d'augmenter la taille des instances de la batterie de serveurs de récupération après un basculement, il est important que chaque type de rôle serveur initial soit représenté.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p117">The environment in Azure can be a smaller version of the production farm. If you plan to scale out the recovery farm after failover, it's important that each type of server role be initially represented.</span></span>
  
<span data-ttu-id="26d6c-p118">Il se peut que la réplication de certaines configurations ne se prête pas à l’environnement de basculement. Veillez à tester les procédures et l’environnement de basculement pour vous assurer que la batterie de basculement fournit le niveau de service attendu.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p118">Some configurations might not be practical to replicate in the failover environment. Be sure to test the failover procedures and environment to help ensure that the failover farm provides the expected service level.</span></span>
  
<span data-ttu-id="26d6c-p119">Cette solution ne préconise aucune topologie spécifique pour une batterie de serveurs SharePoint. Cette solution utilise Azure pour la batterie de basculement et implémente la copie des journaux de transaction et la réplication DFS entre les deux environnements.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p119">This solution doesn't prescribe a specific topology for a SharePoint farm. The focus of this solution is to use Azure for the failover farm and to implement log shipping and DFSR between the two environments.</span></span>
  
### <a name="warm-standby-environments"></a><span data-ttu-id="26d6c-212">Environnements de secours semi-automatique</span><span class="sxs-lookup"><span data-stu-id="26d6c-212">Warm standby environments</span></span>

<span data-ttu-id="26d6c-p120">Dans un environnement de secours semi-automatique, toutes les machines virtuelles dans l'environnement Azure sont en cours d'exécution. L'environnement est prêt pour un exercice ou un événement de basculement.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p120">In a warm standby environment, all virtual machines in the Azure environment are running. The environment is ready for a failover exercise or event.</span></span>
  
<span data-ttu-id="26d6c-215">Le schéma suivant illustre une solution de récupération d'urgence à partir d'une batterie de serveurs SharePoint locale vers une batterie de serveurs SharePoint basée dans Azure et configurée comme un environnement de secours semi-automatique.</span><span class="sxs-lookup"><span data-stu-id="26d6c-215">The following figure illustrates a disaster recovery solution from an on-premises SharePoint farm to an Azure-based SharePoint farm that is configured as a warm standby environment.</span></span>
  
<span data-ttu-id="26d6c-216">**Schéma : Topologie et principaux éléments d'une batterie de production et d'une batterie de récupération de secours semi-automatique.**</span><span class="sxs-lookup"><span data-stu-id="26d6c-216">**Figure: Topology and key elements of a production farm and a warm standby recovery farm**</span></span>

![Topologie d’une batterie de serveurs SharePoint et d’une batterie de serveurs de récupération de secours semi-automatique](../media/AZarch-AZWarmStndby.png)
  
<span data-ttu-id="26d6c-218">Dans ce schéma :</span><span class="sxs-lookup"><span data-stu-id="26d6c-218">In this diagram:</span></span>
  
- <span data-ttu-id="26d6c-219">Deux environnements sont illustrés côte à côte : la batterie de serveurs SharePoint locale et la batterie de serveurs de récupération de secours semi-automatique dans Azure.</span><span class="sxs-lookup"><span data-stu-id="26d6c-219">Two environments are illustrated side by side: the on-premises SharePoint farm and the warm standby farm in Azure.</span></span>
    
- <span data-ttu-id="26d6c-220">Chaque environnement inclut un partage de fichiers.</span><span class="sxs-lookup"><span data-stu-id="26d6c-220">Each environment includes a file share.</span></span>
    
- <span data-ttu-id="26d6c-p121">Chaque batterie de serveurs comprend quatre niveaux. Pour obtenir une haute disponibilité, chaque niveau comprend deux serveurs ou machines virtuelles configurés de manière identique pour un rôle spécifique, comme les services frontaux, le cache distribué, les services de serveur principal et les bases de données. Dans ce schéma, il n’est pas important de désigner des composants spécifiques. Les deux batteries de serveurs sont configurées de manière identique.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p121">Each farm includes four tiers. To achieve high availability, each tier includes two servers or virtual machines that are configured identically for a specific role, such as front-end services, distributed cache, back-end services, and databases. It isn't important in this illustration to call out specific components. The two farms are configured identically.</span></span>
    
- <span data-ttu-id="26d6c-p122">Le quatrième niveau est le niveau de la base de données. La copie des journaux de transaction permet de copier les journaux depuis le serveur de base de données secondaire situé dans l’environnement local vers le partage de fichiers situé dans le même environnement.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p122">The fourth tier is the database tier. Log shipping is used to copy logs from the secondary database server in the on-premises environment to the file share in the same environment.</span></span>
    
- <span data-ttu-id="26d6c-227">La réplication DFS copie les fichiers du partage de fichiers situé dans l'environnement local vers le partage de fichiers situé dans l'environnement Azure.</span><span class="sxs-lookup"><span data-stu-id="26d6c-227">DFSR copies files from the file share in the on-premises environment to the file share in the Azure environment.</span></span>
    
- <span data-ttu-id="26d6c-228">La copie des journaux de transaction relit les journaux de transaction depuis le partage de fichiers situé dans l'environnement Azure vers le réplica principal situé dans le groupe de disponibilité AlwaysOn SQL Server dans l'environnement de récupération.</span><span class="sxs-lookup"><span data-stu-id="26d6c-228">Log shipping replays the logs from the file share in the Azure environment to the primary replica in the SQL Server AlwaysOn availability group in the recovery environment.</span></span>
    
### <a name="cold-standby-environments"></a><span data-ttu-id="26d6c-229">Environnements à reprise progressive</span><span class="sxs-lookup"><span data-stu-id="26d6c-229">Cold standby environments</span></span>

<span data-ttu-id="26d6c-p123">Dans un environnement à reprise progressive, la plupart des machines virtuelles de batterie de serveurs SharePoint peuvent être arrêtées. (Il est recommandé de démarrer les machines virtuelles de temps en temps, par exemple toutes les deux semaines ou une fois par mois, afin que chacune d'elles puisse être synchronisée avec le domaine.) Les machines virtuelles suivantes situées dans l'environnement de récupération Azure doivent rester en cours d'exécution pour garantir la continuité des opérations de copie des journaux et de réplication DFS :</span><span class="sxs-lookup"><span data-stu-id="26d6c-p123">In a cold standby environment, most of the SharePoint farm virtual machines can be shut down. (We recommend occasionally starting the virtual machines, such as every two weeks or once a month, so that each virtual machine can sync with the domain.) The following virtual machines in the Azure recovery environment must remain running to help ensure continuous operations of log shipping and DFSR:</span></span>
  
- <span data-ttu-id="26d6c-232">Le partage de fichiers</span><span class="sxs-lookup"><span data-stu-id="26d6c-232">The file share</span></span>
    
- <span data-ttu-id="26d6c-233">Le serveur de la base de données principale</span><span class="sxs-lookup"><span data-stu-id="26d6c-233">The primary database server</span></span>
    
- <span data-ttu-id="26d6c-234">Au moins une machine virtuelle exécutant les services de domaine Windows Server Active Directory et les services DNS</span><span class="sxs-lookup"><span data-stu-id="26d6c-234">At least one virtual machine running Windows Server Active Directory Domain Services and DNS</span></span>
    
<span data-ttu-id="26d6c-p124">Le schéma suivant illustre un environnement de basculement Azure dans lequel la machine virtuelle de partage de fichiers et la machine virtuelle de base de données SharePoint principale sont en cours d'exécution. Toutes les autres machines virtuelles SharePoint sont arrêtées. La machine virtuelle qui exécute Windows Server Active Directory et les services DNS n'est pas représentée.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p124">The following figure shows an Azure failover environment in which the file share virtual machine and the primary SharePoint database virtual machine are running. All other SharePoint virtual machines are stopped. The virtual machine that is running Windows Server Active Directory and DNS is not shown.</span></span>
  
<span data-ttu-id="26d6c-238">**Schéma : Batterie de récupération à reprise progressive avec machines virtuelles exécutées**</span><span class="sxs-lookup"><span data-stu-id="26d6c-238">**Figure: Cold standby recovery farm with running virtual machines**</span></span>

![Éléments d’une solution de reprise progressive SharePoint dans Azure.](../media/AZarch-AZColdStndby.png)
  
<span data-ttu-id="26d6c-240">Après le basculement vers un environnement à reprise progressive, toutes les machines virtuelles sont démarrées et la méthode pour obtenir une haute disponibilité des serveurs de base de données doit être configurée, par exemple les groupes de disponibilité AlwaysOn SQL Server.</span><span class="sxs-lookup"><span data-stu-id="26d6c-240">After failover to a cold standby environment, all virtual machines are started, and the method to achieve high availability of the database servers must be configured, such as SQL Server AlwaysOn availability groups.</span></span>
  
<span data-ttu-id="26d6c-241">Si plusieurs groupes de stockage sont implémentés (les bases de données sont réparties sur plusieurs groupes à haute disponibilité SQL Server), la base de données principale pour chaque groupe de stockage doit être en cours d'exécution pour accepter les journaux associés à son groupe de stockage.</span><span class="sxs-lookup"><span data-stu-id="26d6c-241">If multiple storage groups are implemented (databases are spread across more than one SQL Server high availability set), the primary database for each storage group must be running to accept the logs associated with its storage group.</span></span>
  
### <a name="skills-and-experience"></a><span data-ttu-id="26d6c-242">Compétences et expérience</span><span class="sxs-lookup"><span data-stu-id="26d6c-242">Skills and experience</span></span>

<span data-ttu-id="26d6c-p125">Plusieurs technologies sont utilisées dans cette solution de récupération d'urgence. Pour garantir que ces technologies interagissent de manière appropriée, chaque composant dans l'environnement local et Azure doit être installé et configuré correctement. Il est recommandé que la personne ou l'équipe qui configure cette solution détienne des connaissances et des compétences solides des technologies décrites dans les articles suivants :</span><span class="sxs-lookup"><span data-stu-id="26d6c-p125">Multiple technologies are used in this disaster recovery solution. To help ensure that these technologies interact as expected, each component in the on-premises and Azure environment must be installed and configured correctly. We recommend that the person or team who sets up this solution have a strong working knowledge of and hands-on skills with the technologies described in the following articles:</span></span>
  
- <span data-ttu-id="26d6c-246">[Services de réplication de système de fichiers DFS](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/jj127250(v=ws.11))</span><span class="sxs-lookup"><span data-stu-id="26d6c-246">[Distributed File System (DFS) Replication Services](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/jj127250(v=ws.11))</span></span>
    
- [<span data-ttu-id="26d6c-247">Clustering de basculement Windows Server (WSFC) avec SQL Server</span><span class="sxs-lookup"><span data-stu-id="26d6c-247">Windows Server Failover Clustering (WSFC) with SQL Server</span></span>](/sql/sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server)
    
- [<span data-ttu-id="26d6c-248">Groupes de disponibilité AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="26d6c-248">AlwaysOn Availability Groups (SQL Server)</span></span>](/sql/database-engine/availability-groups/windows/always-on-availability-groups-sql-server)
    
- [<span data-ttu-id="26d6c-249">Sauvegarde et restauration des bases de données SQL Server </span><span class="sxs-lookup"><span data-stu-id="26d6c-249">Back Up and Restore of SQL Server Databases</span></span>](/sql/relational-databases/backup-restore/back-up-and-restore-of-sql-server-databases)
    
- [<span data-ttu-id="26d6c-250">Déploiement de batterie de serveurs et installation de SharePoint Server 2013</span><span class="sxs-lookup"><span data-stu-id="26d6c-250">SharePoint Server 2013 installation and farm deployment</span></span>](/SharePoint/install/installation-and-configuration-overview)
    
- [<span data-ttu-id="26d6c-251">Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="26d6c-251">Microsoft Azure</span></span>](/azure/)
    
<span data-ttu-id="26d6c-p126">Enfin, il est recommandé de posséder des compétences en matière d'écriture de scripts, car il peut être utile d'utiliser des scripts pour automatiser des tâches associées à ces technologies. Il est possible d'utiliser les interfaces utilisateur disponibles pour effectuer toutes les tâches décrites dans cette solution. Toutefois, l'approche manuelle, longue, est source d'erreurs et fournit des résultats incohérents.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p126">Finally, we recommend scripting skills that you can use to automate tasks associated with these technologies. It's possible to use the available user interfaces to complete all the tasks described in this solution. However, a manual approach can be time consuming and error prone and delivers inconsistent results.</span></span>
  
<span data-ttu-id="26d6c-p127">Outre Windows PowerShell, il existe également des bibliothèques Windows PowerShell pour SQL Server, SharePoint Server et Azure. N'oubliez pas T-SQL qui peut également permettre de réduire le temps de configuration et de gestion de votre environnement de récupération d'urgence.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p127">In addition to Windows PowerShell, there are also Windows PowerShell libraries for SQL Server, SharePoint Server, and Azure. Don't forget T-SQL, which can also help reduce the time to configure and maintain your disaster-recovery environment.</span></span>
  
## <a name="disaster-recovery-roadmap"></a><span data-ttu-id="26d6c-257">Feuille de route de récupération d’urgence</span><span class="sxs-lookup"><span data-stu-id="26d6c-257">Disaster recovery roadmap</span></span>

![Représentation visuelle de la feuille de route de récupération d’urgence SharePoint.](../media/Azure-DRroadmap.png)
  
<span data-ttu-id="26d6c-259">Cette feuille de route part du principe que vous disposez déjà d'une batterie de serveurs SharePoint Server 2013 déployée en production.</span><span class="sxs-lookup"><span data-stu-id="26d6c-259">This roadmap assumes that you already have a SharePoint Server 2013 farm deployed in production.</span></span>
  
<span data-ttu-id="26d6c-260">**Tableau : Feuille de route de récupération d'urgence**</span><span class="sxs-lookup"><span data-stu-id="26d6c-260">**Table: Roadmap for disaster recovery**</span></span>

|<span data-ttu-id="26d6c-261">**Étape**</span><span class="sxs-lookup"><span data-stu-id="26d6c-261">**Phase**</span></span>|<span data-ttu-id="26d6c-262">**Description**</span><span class="sxs-lookup"><span data-stu-id="26d6c-262">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="26d6c-263">Étape 1</span><span class="sxs-lookup"><span data-stu-id="26d6c-263">Phase 1</span></span>  <br/> |<span data-ttu-id="26d6c-264">Conception de l’environnement de récupération d’urgence.</span><span class="sxs-lookup"><span data-stu-id="26d6c-264">Design the disaster recovery environment.</span></span>  <br/> |
|<span data-ttu-id="26d6c-265">Étape 2</span><span class="sxs-lookup"><span data-stu-id="26d6c-265">Phase 2</span></span>  <br/> |<span data-ttu-id="26d6c-266">Création du réseau virtuel Azure et de la connexion VPN.</span><span class="sxs-lookup"><span data-stu-id="26d6c-266">Create the Azure virtual network and VPN connection.</span></span>  <br/> |
|<span data-ttu-id="26d6c-267">Étape 3</span><span class="sxs-lookup"><span data-stu-id="26d6c-267">Phase 3</span></span>  <br/> |<span data-ttu-id="26d6c-268">Déploiement d’Active Directory et des services de nom de domaine sur le réseau Azure Virtual Network.</span><span class="sxs-lookup"><span data-stu-id="26d6c-268">Deploy Windows Active Directory and Domain Name Services to the Azure virtual network.</span></span>  <br/> |
|<span data-ttu-id="26d6c-269">Étape 4</span><span class="sxs-lookup"><span data-stu-id="26d6c-269">Phase 4</span></span>  <br/> |<span data-ttu-id="26d6c-270">Déploiement de la batterie de serveurs de récupération SharePoint dans Azure.</span><span class="sxs-lookup"><span data-stu-id="26d6c-270">Deploy the SharePoint recovery farm in Azure.</span></span>  <br/> |
|<span data-ttu-id="26d6c-271">Étape 5</span><span class="sxs-lookup"><span data-stu-id="26d6c-271">Phase 5</span></span>  <br/> |<span data-ttu-id="26d6c-272">Configuration de DFSR entre les batteries de serveurs.</span><span class="sxs-lookup"><span data-stu-id="26d6c-272">Set up DFSR between the farms.</span></span>  <br/> |
|<span data-ttu-id="26d6c-273">Étape 6</span><span class="sxs-lookup"><span data-stu-id="26d6c-273">Phase 6</span></span>  <br/> |<span data-ttu-id="26d6c-274">Configuration de la copie des journaux de transaction vers la batterie de récupération.</span><span class="sxs-lookup"><span data-stu-id="26d6c-274">Set up log shipping to the recovery farm.</span></span>  <br/> |
|<span data-ttu-id="26d6c-275">Étape 7</span><span class="sxs-lookup"><span data-stu-id="26d6c-275">Phase 7</span></span>  <br/> | <span data-ttu-id="26d6c-p128">Validation des solutions de récupération et de basculement. Cela inclut les procédures et les technologies suivantes :</span><span class="sxs-lookup"><span data-stu-id="26d6c-p128">Validate failover and recovery solutions. This includes the following procedures and technologies:</span></span> <br/>  <span data-ttu-id="26d6c-278">Arrêt de la copie des journaux de transaction</span><span class="sxs-lookup"><span data-stu-id="26d6c-278">Stop log shipping.</span></span> <br/>  <span data-ttu-id="26d6c-279">Restauration des sauvegardes</span><span class="sxs-lookup"><span data-stu-id="26d6c-279">Restore the backups.</span></span> <br/>  <span data-ttu-id="26d6c-280">Analyse du contenu</span><span class="sxs-lookup"><span data-stu-id="26d6c-280">Crawl content.</span></span> <br/>  <span data-ttu-id="26d6c-281">Récupération des services</span><span class="sxs-lookup"><span data-stu-id="26d6c-281">Recover services.</span></span> <br/>  <span data-ttu-id="26d6c-282">Gestion des enregistrements DNS</span><span class="sxs-lookup"><span data-stu-id="26d6c-282">Manage DNS records.</span></span> <br/> |
   
## <a name="phase-1-design-the-disaster-recovery-environment"></a><span data-ttu-id="26d6c-283">Étape 1 : Conception de l’environnement de récupération d’urgence</span><span class="sxs-lookup"><span data-stu-id="26d6c-283">Phase 1: Design the disaster recovery environment</span></span>

<span data-ttu-id="26d6c-284">Utilisez les instructions figurant dans la rubrique [Architectures Microsoft Azure pour SharePoint 2013](microsoft-azure-architectures-for-sharepoint-2013.md) pour concevoir l'environnement de récupération d'urgence, y compris la batterie de serveurs de récupération SharePoint.</span><span class="sxs-lookup"><span data-stu-id="26d6c-284">Use the guidance in [Microsoft Azure Architectures for SharePoint 2013](microsoft-azure-architectures-for-sharepoint-2013.md) to design the disaster-recovery environment, including the SharePoint recovery farm.</span></span> <span data-ttu-id="26d6c-285">Vous pouvez utiliser les graphiques de la [solution SharePoint récupération](https://go.microsoft.com/fwlink/p/?LinkId=392554) d’urgence dans Azure Visio pour démarrer le processus de conception.</span><span class="sxs-lookup"><span data-stu-id="26d6c-285">You can use the graphics in the [SharePoint Disaster Recovery Solution in Azure](https://go.microsoft.com/fwlink/p/?LinkId=392554) Visio file to start the design process.</span></span> <span data-ttu-id="26d6c-286">Il est recommandé de concevoir l'intégralité de l'environnement avant de commencer à travailler dans l'environnement Azure.</span><span class="sxs-lookup"><span data-stu-id="26d6c-286">We recommend that you design the entire environment before beginning any work in the Azure environment.</span></span>
  
<span data-ttu-id="26d6c-287">Outre les instructions fournies dans la rubrique [Architectures Microsoft Azure pour SharePoint 2013](microsoft-azure-architectures-for-sharepoint-2013.md) pour la conception du réseau virtuel, de la connexion VPN, d'Active Directory et de la batterie SharePoint, veillez à ajouter un rôle de partage de fichiers à l'environnement Azure.</span><span class="sxs-lookup"><span data-stu-id="26d6c-287">In addition to the guidance provided in [Microsoft Azure Architectures for SharePoint 2013](microsoft-azure-architectures-for-sharepoint-2013.md) for designing the virtual network, VPN connection, Active Directory, and SharePoint farm, be sure to add a file share role to the Azure environment.</span></span>
  
<span data-ttu-id="26d6c-p130">Pour prendre en charge la copie des journaux de transaction dans une solution de récupération d’urgence, une machine virtuelle de partage de fichiers est ajoutée au sous-réseau dans lequel les rôles de base de données se trouvent. Le partage de fichiers sert également de troisième nœud d’un nœud majoritaire pour le groupe de disponibilité AlwaysOn SQL Server. Il s’agit de la configuration recommandée pour une batterie de serveurs SharePoint standard qui utilise des groupes de disponibilité AlwaysOn SQL Server.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p130">To support log shipping in a disaster-recovery solution, a file share virtual machine is added to the subnet where the database roles reside. The file share also serves as the third node of a Node Majority for the SQL Server AlwaysOn availability group. This is the recommended configuration for a standard SharePoint farm that uses SQL Server AlwaysOn availability groups.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="26d6c-p131">Il est important de consulter la configuration requise pour qu'une base de données puisse participer à un groupe de disponibilité AlwaysOn SQL Server. Pour plus d'informations, voir [Conditions préalables requises, restrictions et recommandations pour les groupes de disponibilité AlwaysOn](/sql/database-engine/availability-groups/windows/prereqs-restrictions-recommendations-always-on-availability).</span><span class="sxs-lookup"><span data-stu-id="26d6c-p131">It is important to review the prerequisites for a database to participate in a SQL Server AlwaysOn availability group. For more information, see [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups](/sql/database-engine/availability-groups/windows/prereqs-restrictions-recommendations-always-on-availability).</span></span> 
  
<span data-ttu-id="26d6c-293">**Schéma : Placement d'un serveur de fichiers utilisé pour une solution de récupération d'urgence**</span><span class="sxs-lookup"><span data-stu-id="26d6c-293">**Figure: Placement of a file server used for a disaster recovery solution**</span></span>

![Présente un ordinateur virtuel de partage de fichiers ajouté au même service cloud qui contient les rôles serveur de base de données SharePoint.](../media/AZenv-FSforDFSRandWSFC.png)
  
<span data-ttu-id="26d6c-p132">Dans ce schéma, une machine virtuelle de partage de fichiers est ajoutée au même sous-réseau dans Azure qui contient les rôles serveur de base de données. N’ajoutez pas la machine virtuelle de partage de fichiers à un groupe à haute disponibilité présentant d’autres rôles serveur, tels que les rôles SQL Server.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p132">In this diagram, a file share virtual machine is added to the same subnet in Azure that contains the database server roles. Do not add the file share virtual machine to an availability set with other server roles, such as the SQL Server roles.</span></span>
  
<span data-ttu-id="26d6c-p133">Si vous êtes préoccupé par la haute disponibilité des journaux, employez une approche différente en vous aidant de la rubrique [Sauvegarde et restauration SQL Server avec le service de stockage d'objets blob Azure](/sql/relational-databases/backup-restore/sql-server-backup-and-restore-with-microsoft-azure-blob-storage-service). Il s'agit d'une nouvelle fonctionnalité d'Azure qui enregistre les journaux directement dans une URL de stockage BLOB. Cette solution ne donne pas d'instructions sur l'utilisation de cette fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p133">If you are concerned about the high availability of the logs, consider taking a different approach by using [SQL Server backup and restore with Azure Blob Storage Service](/sql/relational-databases/backup-restore/sql-server-backup-and-restore-with-microsoft-azure-blob-storage-service). This is a new feature in Azure that saves logs directly to a blob storage URL. This solution does not include guidance about using this feature.</span></span>
  
<span data-ttu-id="26d6c-p134">Lorsque vous concevez la batterie de serveurs de récupération, n'oubliez pas qu'un environnement de récupération d'urgence réussi reflète précisément la batterie de serveurs de production que vous souhaitez récupérer. La taille de la batterie de serveurs de récupération n'est pas l'aspect le plus important de la conception, du déploiement et du test de la batterie de récupération. La taille de la batterie de serveurs varie selon les organisations, en fonction des besoins de l'entreprise. Il est possible d'utiliser une batterie de serveurs réduite pour les interruptions de courte durée ou jusqu'à ce que les besoins en performances et en capacité exigent l'augmentation de la taille de la batterie de serveurs.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p134">When you design the recovery farm, keep in mind that a successful disaster recovery environment accurately reflects the production farm that you want to recover. The size of the recovery farm is not the most important thing in the recovery farm's design, deployment, and testing. Farm scale varies from organization to organization based on business requirements. It might be possible to use a scaled-down farm for a short outage or until performance and capacity demands require you to scale the farm.</span></span>
  
<span data-ttu-id="26d6c-p135">Configurez la batterie de serveurs de récupération de façon aussi identique que possible à la batterie de serveurs de production, afin qu’elle réponde aux exigences de votre contrat de niveau de service et remplisse son rôle au sein de votre entreprise. Lorsque vous concevez l’environnement de récupération d’urgence, consultez également le processus de gestion des modifications de votre environnement de production. Il est recommandé d’étendre le processus de gestion des modifications à l’environnement de récupération en définissant l’intervalle de l’environnement de récupération sur la même valeur que celui de l’environnement de production. Dans le cadre du processus de gestion des modifications, il est recommandé de conserver les détails de la configuration, des applications et des utilisateurs de votre batterie de serveurs.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p135">Configure the recovery farm as identically as possible to the production farm so that it meets your service level agreement (SLA) requirements and provides the functionality that you need to support your business. When you design the disaster recovery environment, also look at your change management process for your production environment. We recommend that you extend the change management process to the recovery environment by updating the recovery environment at the same interval as the production environment. As part of the change management process, we recommend maintaining a detailed inventory of your farm configuration, applications, and users.</span></span> 
  
## <a name="phase-2-create-the-azure-virtual-network-and-vpn-connection"></a><span data-ttu-id="26d6c-308">Étape 2 : Création du réseau virtuel Azure et de la connexion VPN</span><span class="sxs-lookup"><span data-stu-id="26d6c-308">Phase 2: Create the Azure virtual network and VPN connection</span></span>

<span data-ttu-id="26d6c-p136">La rubrique [Connecter un réseau local à Microsoft Azure Virtual Network](connect-an-on-premises-network-to-a-microsoft-azure-virtual-network.md) vous explique comment planifier et déployer le réseau virtuel dans Azure et comment créer la connexion VPN. Suivez les instructions de la rubrique pour exécuter les procédures suivantes :</span><span class="sxs-lookup"><span data-stu-id="26d6c-p136">[Connect an on-premises network to a Microsoft Azure virtual network](connect-an-on-premises-network-to-a-microsoft-azure-virtual-network.md) shows you how to plan and deploy the virtual network in Azure and how to create the VPN connection. Follow the guidance in the topic to complete the following procedures:</span></span>
  
- <span data-ttu-id="26d6c-311">Planification de l'espace d'adressage IP privé du réseau Virtual Network.</span><span class="sxs-lookup"><span data-stu-id="26d6c-311">Plan the private IP address space of the Virtual Network.</span></span>
    
- <span data-ttu-id="26d6c-312">Planification des modifications d'infrastructure de routage pour le réseau Virtual Network.</span><span class="sxs-lookup"><span data-stu-id="26d6c-312">Plan the routing infrastructure changes for the Virtual Network.</span></span>
    
- <span data-ttu-id="26d6c-313">Planification des règles de pare-feu pour le trafic vers et depuis le périphérique VPN local.</span><span class="sxs-lookup"><span data-stu-id="26d6c-313">Plan firewall rules for traffic to and from the on-premises VPN device.</span></span>
    
- <span data-ttu-id="26d6c-314">Création du réseau virtuel entre différents locaux dans Azure.</span><span class="sxs-lookup"><span data-stu-id="26d6c-314">Create the cross-premises virtual network in Azure.</span></span>
    
- <span data-ttu-id="26d6c-315">Configuration du routage entre votre réseau local et le réseau Virtual Network.</span><span class="sxs-lookup"><span data-stu-id="26d6c-315">Configure routing between your on-premises network and the Virtual Network.</span></span>
    
## <a name="phase-3-deploy-active-directory-and-domain-name-services-to-the-azure-virtual-network"></a><span data-ttu-id="26d6c-316">Étape 3 : Déploiement d’Active Directory et des services de nom de domaine sur le réseau Azure Virtual Network.</span><span class="sxs-lookup"><span data-stu-id="26d6c-316">Phase 3: Deploy Active Directory and Domain Name Services to the Azure virtual network</span></span>

<span data-ttu-id="26d6c-317">Cette étape comprend le déploiement de Windows Server Active Directory et de DNS pour le réseau Virtual Network dans un scénario hybride comme décrit dans [Architectures Microsoft Azure pour SharePoint 2013](microsoft-azure-architectures-for-sharepoint-2013.md) et comme l'illustre le schéma suivant.</span><span class="sxs-lookup"><span data-stu-id="26d6c-317">This phase includes deploying both Windows Server Active Directory and DNS to the Virtual Network in a hybrid scenario as described in [Microsoft Azure Architectures for SharePoint 2013](microsoft-azure-architectures-for-sharepoint-2013.md) and as illustrated in the following figure.</span></span>
  
<span data-ttu-id="26d6c-318">**Schéma : Configuration du domaine Active Directory hybride**</span><span class="sxs-lookup"><span data-stu-id="26d6c-318">**Figure: Hybrid Active Directory domain configuration**</span></span>

![Deux machines virtuelles déployées sur le réseau virtuel Azure et le sous-réseau de la batterie de serveurs SharePoint sont des contrôleurs de domaine réplicas et des serveurs DNS](../media/AZarch-HyADdomainConfig.png)
  
<span data-ttu-id="26d6c-p137">Dans l’illustration, deux machines virtuelles sont déployées vers le même sous-réseau. Ces machines virtuelles hébergent chacune deux rôles : Active Directory et DNS.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p137">In the illustration, two virtual machines are deployed to the same subnet. These virtual machines are each hosting two roles: Active Directory and DNS.</span></span>
  
<span data-ttu-id="26d6c-p138">Avant de déployer Active Directory dans Azure, lisez les [Recommandations en matière de déploiement de Windows Server Active Directory sur des machines virtuelles Windows Azure](/windows-server/identity/ad-ds/introduction-to-active-directory-domain-services-ad-ds-virtualization-level-100). Elles vous aideront à déterminer si une architecture différente ou des paramètres de configuration différents sont nécessaires pour votre solution.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p138">Before deploying Active Directory in Azure, read [Guidelines for Deploying Windows Server Active Directory on Azure Virtual Machines](/windows-server/identity/ad-ds/introduction-to-active-directory-domain-services-ad-ds-virtualization-level-100). These guidelines help you determine whether you need a different architecture or different configuration settings for your solution.</span></span>
  
<span data-ttu-id="26d6c-324">Pour obtenir des instructions détaillées sur la configuration d'un contrôleur de domaine dans Azure, voir [Installation d'un contrôleur de domaine Active Directory de réplication dans un réseau virtuel Azure](/windows-server/identity/ad-ds/introduction-to-active-directory-domain-services-ad-ds-virtualization-level-100).</span><span class="sxs-lookup"><span data-stu-id="26d6c-324">For detailed guidance on setting up a domain controller in Azure, see [Install a Replica Active Directory Domain Controller in Azure Virtual Networks](/windows-server/identity/ad-ds/introduction-to-active-directory-domain-services-ad-ds-virtualization-level-100).</span></span>
  
<span data-ttu-id="26d6c-p139">Avant cette étape, vous n'avez pas déployé de machines virtuelles sur le réseau Virtual Network. Les machines virtuelles pour l'hébergement d'Active Directory et des services DNS ne sont probablement pas assez grandes pour la solution. Avant de déployer ces machines virtuelles, créez d'abord la plus grande machine virtuelle que vous avez prévu d'utiliser dans votre réseau Virtual Network. Cela garantit le renvoi de votre solution vers une balise dans Azure qui permet d'obtenir la plus grande taille dont vous avez besoin. Il est inutile de configurer cette machine virtuelle pour le moment. Créez-la et mettez-la simplement de côté. Si vous ne procédez pas ainsi, vous risquez d'être limité lors de la création ultérieure de machines virtuelles plus importantes, ce qui constituait un problème au moment de la rédaction de cet article.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p139">Before this phase, you didn't deploy virtual machines to the Virtual Network. The virtual machines for hosting Active Directory and DNS are likely not the largest virtual machines you need for the solution. Before you deploy these virtual machines, first create the largest virtual machine that you plan to use in your Virtual Network. This helps ensure that your solution lands on a tag in Azure that allows the largest size you need. You do not need to configure this virtual machine at this time. Simply create it, and set it aside. If you do not do this, you might run into a limitation when you try to create larger virtual machines later, which was an issue at the time this article was written.</span></span> 
  
## <a name="phase-4-deploy-the-sharepoint-recovery-farm-in-azure"></a><span data-ttu-id="26d6c-332">Étape 4 : Déploiement de la batterie de serveurs de récupération SharePoint dans Azure</span><span class="sxs-lookup"><span data-stu-id="26d6c-332">Phase 4: Deploy the SharePoint recovery farm in Azure</span></span>

<span data-ttu-id="26d6c-p140">Déployez la batterie de serveurs SharePoint dans votre réseau Virtual Network en fonction de vos plans de conception. Vous aurez peut-être besoin de vous référer à la rubrique [Planification de SharePoint 2013 dans les services d'infrastructure Azure](/previous-versions/azure/dn275958(v=azure.100)) avant de déployer les rôles SharePoint dans Azure.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p140">Deploy the SharePoint farm in your Virtual Network according to your design plans. It might be helpful to review [Planning for SharePoint 2013 on Azure Infrastructure Services](/previous-versions/azure/dn275958(v=azure.100)) before you deploy SharePoint roles in Azure.</span></span>
  
<span data-ttu-id="26d6c-335">Tenez compte des pratiques suivantes, que nous avons apprises en créant notre environnement de preuve de concept :</span><span class="sxs-lookup"><span data-stu-id="26d6c-335">Consider the following practices that we learned by building our proof of concept environment:</span></span>
  
- <span data-ttu-id="26d6c-336">Créez des machines virtuelles à l’aide du portail Azure ou de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="26d6c-336">Create virtual machines by using the Azure portal or PowerShell.</span></span>
    
- <span data-ttu-id="26d6c-p141">Azure et Hyper-V ne prennent pas en charge la mémoire dynamique. Veillez à ce que cela soit pris en compte dans vos plans de capacité et de performances.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p141">Azure and Hyper-V do not support dynamic memory. Be sure this is factored into your performance and capacity plans.</span></span>
    
- <span data-ttu-id="26d6c-p142">Redémarrez les machines virtuelles via l’interface Azure et non à partir de la connexion de la machine virtuelle. Ce processus fonctionne mieux et est plus prévisible.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p142">Restart virtual machines through the Azure interface, not from the virtual machine logon itself. Using the Azure interface works better and is more predictable.</span></span>
    
- <span data-ttu-id="26d6c-p143">Si vous souhaitez arrêter une machine virtuelle pour réduire les coûts, utilisez l’interface Azure. Si vous arrêtez la machine à partir de la connexion de la machine virtuelle, les frais continuent à augmenter.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p143">If you want to shut down a virtual machine to save costs, use the Azure interface. If you shut down from the virtual machine logon, charges continue to accrue.</span></span>
    
- <span data-ttu-id="26d6c-343">Utilisez une convention d’attribution de noms pour les machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="26d6c-343">Use a naming convention for the virtual machines.</span></span>
    
- <span data-ttu-id="26d6c-344">Soyez vigilant quant à l’emplacement de centre de données où les machines virtuelles sont déployées.</span><span class="sxs-lookup"><span data-stu-id="26d6c-344">Pay attention to which datacenter location the virtual machines are being deployed.</span></span>
    
- <span data-ttu-id="26d6c-345">La fonctionnalité de mise à l’échelle automatique dans Azure n’est pas prise en charge pour les rôles SharePoint.</span><span class="sxs-lookup"><span data-stu-id="26d6c-345">The automatic scaling feature in Azure is not supported for SharePoint roles.</span></span>
    
- <span data-ttu-id="26d6c-346">Ne configurez pas d’éléments dans la batterie de serveurs qui sera restaurée, comme des collections de sites.</span><span class="sxs-lookup"><span data-stu-id="26d6c-346">Do not configure items in the farm that will be restored, such as site collections.</span></span> 
    
## <a name="phase-5-set-up-dfsr-between-the-farms"></a><span data-ttu-id="26d6c-347">Étape 5 : Configuration de DFSR entre les batteries de serveurs</span><span class="sxs-lookup"><span data-stu-id="26d6c-347">Phase 5: Set up DFSR between the farms</span></span>

<span data-ttu-id="26d6c-p144">Pour configurer la réplication de fichiers à l'aide de la réplication DFS, utilisez le composant logiciel enfichable Gestion du service DNS. Toutefois, avant la configuration de la réplication DFS, connectez-vous à votre serveur de fichiers local et au serveur de fichiers Azure et activez le service dans Windows.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p144">To set up file replication by using DFSR, use the DNS Management snap-in. However, before the DFSR setup, log on to your on-premises file server and Azure file server and enable the service in Windows.</span></span>
  
<span data-ttu-id="26d6c-350">Sur le tableau de bord du gestionnaire de serveur, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="26d6c-350">From the Server Manager Dashboard, complete the following steps:</span></span>
  
- <span data-ttu-id="26d6c-351">Configurez le serveur local.</span><span class="sxs-lookup"><span data-stu-id="26d6c-351">Configure the local server.</span></span>
    
- <span data-ttu-id="26d6c-352">Démarrez l' **Assistant Ajout de rôles et de fonctionnalités**.</span><span class="sxs-lookup"><span data-stu-id="26d6c-352">Start the **Add Roles and Features Wizard**.</span></span>
    
- <span data-ttu-id="26d6c-353">Ouvrez le nœud **Services de fichiers et de stockage**.</span><span class="sxs-lookup"><span data-stu-id="26d6c-353">Open the **File and Storage Services** node.</span></span>
    
- <span data-ttu-id="26d6c-354">Sélectionnez **Espaces de noms DFS** et **Réplication DFS**.</span><span class="sxs-lookup"><span data-stu-id="26d6c-354">Select **DFS Namespaces** and **DFS replication**.</span></span>
    
- <span data-ttu-id="26d6c-355">Cliquez sur **Suivant** pour terminer l'Assistant.</span><span class="sxs-lookup"><span data-stu-id="26d6c-355">Click **Next** to finish the wizard steps.</span></span>
    
<span data-ttu-id="26d6c-356">Le tableau suivant fournit des liens vers des articles de référence sur la réplication DFS et des billets de blog.</span><span class="sxs-lookup"><span data-stu-id="26d6c-356">The following table provides links to DFSR reference articles and blog posts.</span></span>
  
<span data-ttu-id="26d6c-357">**Tableau : Articles de référence pour la réplication DFS**</span><span class="sxs-lookup"><span data-stu-id="26d6c-357">**Table: Reference articles for DFSR**</span></span>

|<span data-ttu-id="26d6c-358">**Titre**</span><span class="sxs-lookup"><span data-stu-id="26d6c-358">**Title**</span></span>|<span data-ttu-id="26d6c-359">**Description**</span><span class="sxs-lookup"><span data-stu-id="26d6c-359">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="26d6c-360">[Réplication](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc770278(v=ws.11))</span><span class="sxs-lookup"><span data-stu-id="26d6c-360">[Replication](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc770278(v=ws.11))</span></span> <br/> |<span data-ttu-id="26d6c-361">Rubrique TechNet sur la gestion du service DFS avec des liens pour la réplication</span><span class="sxs-lookup"><span data-stu-id="26d6c-361">DFS Management TechNet topic with links for replication</span></span>  <br/> |
|[<span data-ttu-id="26d6c-362">Réplication DFS : guide de survie</span><span class="sxs-lookup"><span data-stu-id="26d6c-362">DFS Replication: Survival Guide</span></span>](https://go.microsoft.com/fwlink/p/?LinkId=392737) <br/> |<span data-ttu-id="26d6c-363">Wiki avec des liens vers des informations DFS</span><span class="sxs-lookup"><span data-stu-id="26d6c-363">Wiki with links to DFS information</span></span>  <br/> |
|<span data-ttu-id="26d6c-364">[Réplication DFS : forum aux questions (FAQ)](/previous-versions/windows/it-pro/windows-server-2003/cc773238(v=ws.10))</span><span class="sxs-lookup"><span data-stu-id="26d6c-364">[DFS Replication: Frequently Asked Questions](/previous-versions/windows/it-pro/windows-server-2003/cc773238(v=ws.10))</span></span> <br/> |<span data-ttu-id="26d6c-365">Rubrique TechNet sur la réplication DFS</span><span class="sxs-lookup"><span data-stu-id="26d6c-365">DFS Replication TechNet topic</span></span>  <br/> |
|[<span data-ttu-id="26d6c-366">Blog de Jose Barreto</span><span class="sxs-lookup"><span data-stu-id="26d6c-366">Jose Barreto's Blog</span></span>](/archive/blogs/josebda/) <br/> |<span data-ttu-id="26d6c-367">Article de blog rédigé par un responsable de programme principal sur l’équipe de serveur de fichiers de Microsoft</span><span class="sxs-lookup"><span data-stu-id="26d6c-367">Blog written by a Principal Program Manager on the File Server team at Microsoft</span></span>  <br/> |
|[<span data-ttu-id="26d6c-368">L'équipe de stockage de Microsoft : blog sur le fichier CAB</span><span class="sxs-lookup"><span data-stu-id="26d6c-368">The Storage Team at Microsoft - File Cabinet Blog</span></span>](https://go.microsoft.com/fwlink/p/?LinkId=392740) <br/> |<span data-ttu-id="26d6c-369">Blog sur les services de fichiers et les fonctionnalités de stockage dans Windows Server</span><span class="sxs-lookup"><span data-stu-id="26d6c-369">Blog about file services and storage features in Windows Server</span></span>  <br/> |
   
## <a name="phase-6-set-up-log-shipping-to-the-recovery-farm"></a><span data-ttu-id="26d6c-370">Étape 6 : Configuration de la copie des journaux de transaction vers la batterie de récupération</span><span class="sxs-lookup"><span data-stu-id="26d6c-370">Phase 6: Set up log shipping to the recovery farm</span></span>

<span data-ttu-id="26d6c-p145">La copie des journaux de transaction est le composant essentiel de la configuration de la récupération d'urgence dans cet environnement. Vous pouvez utiliser la copie des journaux de transaction pour envoyer automatiquement les fichiers journaux de transaction pour les bases de données d'une instance de serveur de la base de données principale vers une instance de serveur de base de données secondaire. Pour configurer la copie des journaux de transaction, voir [Configure log shipping in SharePoint 2013](/sharepoint/administration/configure-log-shipping).</span><span class="sxs-lookup"><span data-stu-id="26d6c-p145">Log shipping is the critical component for setting up disaster recovery in this environment. You can use log shipping to automatically send transaction log files for databases from a primary database server instance to a secondary database server instance. To set up log shipping, see [Configure log shipping in SharePoint 2013](/sharepoint/administration/configure-log-shipping).</span></span> 
  
> [!IMPORTANT]
> <span data-ttu-id="26d6c-p146">La prise en charge de la copie des journaux de transaction dans SharePoint Server est limitée à certaines bases de données. Pour plus d'informations, voir [Options de haute disponibilité et de récupération d'urgence prises en charge pour les bases de données SharePoint (SharePoint 2013)](/SharePoint/administration/supported-high-availability-and-disaster-recovery-options-for-sharepoint-databas).</span><span class="sxs-lookup"><span data-stu-id="26d6c-p146">Log shipping support in SharePoint Server is limited to certain databases. For more information, see [Supported high availability and disaster recovery options for SharePoint databases (SharePoint 2013)](/SharePoint/administration/supported-high-availability-and-disaster-recovery-options-for-sharepoint-databas).</span></span> 
  
## <a name="phase-7-validate-failover-and-recovery"></a><span data-ttu-id="26d6c-376">Étape 7 : Validation du basculement et de la récupération</span><span class="sxs-lookup"><span data-stu-id="26d6c-376">Phase 7: Validate failover and recovery</span></span>

<span data-ttu-id="26d6c-p147">L’objectif de cette phase finale consiste à vérifier que la solution de récupération d’urgence fonctionne comme prévu. Pour ce faire, créez un événement de basculement qui arrête la batterie de serveurs de production et démarre la batterie de serveurs de récupération en remplacement. Vous pouvez démarrer un scénario de basculement manuellement ou à l’aide de scripts.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p147">The goal of this final phase is to verify that the disaster recovery solution works as planned. To do this, create a failover event that shuts down the production farm and starts up the recovery farm as a replacement. You can start a failover scenario manually or by using scripts.</span></span>
  
<span data-ttu-id="26d6c-p148">La première étape consiste à arrêter les requêtes utilisateur entrantes concernant les services ou le contenu de batterie. Pour ce faire, désactivez les entrées DNS ou arrêtez les serveurs web frontaux. Une fois la batterie de serveurs arrêtée, vous pouvez basculer sur la batterie de serveurs de récupération.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p148">The first step is to stop incoming user requests for farm services or content. You can do this by disabling DNS entries or by shutting down the front-end web servers. After the farm is "down," you can fail over to the recovery farm.</span></span>
  
### <a name="stop-log-shipping"></a><span data-ttu-id="26d6c-383">Arrêt de la copie des journaux de transaction</span><span class="sxs-lookup"><span data-stu-id="26d6c-383">Stop log shipping</span></span>

<span data-ttu-id="26d6c-p149">Vous devez arrêter la copie des journaux de transaction avant la récupération de la batterie de serveurs. Arrêtez la copie des journaux de transaction d’abord sur le serveur secondaire dans Azure, puis arrêtez-la sur le serveur principal local. Utilisez le script suivant pour arrêter la copie des journaux de transaction sur le serveur secondaire en premier, puis sur le serveur principal. Les noms de base de données dans le script peuvent différer selon votre environnement.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p149">You must stop log shipping before farm recovery. Stop log shipping on the secondary server in Azure first, and then stop it on the primary server on-premises. Use the following script to stop log shipping on the secondary server first and then on the primary server. The database names in the script might be different, depending on your environment.</span></span>
  
```
-- This script removes log shipping from the server.
-- Commands must be executed on the secondary server first and then on the primary server.

SET NOCOUNT ON
DECLARE  @PriDB nvarchar(max)
,@SecDB nvarchar(250)
,@PriSrv nvarchar(250)
,@SecSrv nvarchar(250)

Set @PriDB= ''
SET @PriDB = UPPER(@PriDB)
SET @PriDB = REPLACE(@PriDB, ' ', '')
SET @PriDB = '''' + REPLACE(@PriDB, ',', ''', ''') + ''''

Set @SecDB = @PriDB

Exec ( 'Select  ''exec master..sp_delete_log_shipping_secondary_database '' + '''''''' + prm.primary_database +  ''''''''   
from msdb.dbo.log_shipping_monitor_primary prm INNER JOIN msdb.dbo.log_shipping_primary_secondaries sec  ON  prm.primary_database=sec.secondary_database
where prm.primary_database in ( ' + @PriDB + ' )')

Exec ( 'Select  ''exec master..sp_delete_log_shipping_primary_secondary '' + '''''''' + prm.Primary_Database + '''''', '''''' + sec.Secondary_Server + '''''', '''''' + sec.Secondary_database + ''''''''   
from msdb.dbo.log_shipping_monitor_primary prm INNER JOIN msdb.dbo.log_shipping_primary_secondaries sec  ON  prm.primary_database=sec.secondary_database
where prm.primary_database in ( ' + @PriDB + ' )')

Exec ( 'Select  ''exec master..sp_delete_log_shipping_primary_database '' + '''''''' + prm.primary_database +  ''''''''   
from msdb.dbo.log_shipping_monitor_primary prm INNER JOIN msdb.dbo.log_shipping_primary_secondaries sec  ON  prm.primary_database=sec.secondary_database
where prm.primary_database in ( ' + @PriDB + ' )')

Exec ( 'Select  ''exec master..sp_delete_log_shipping_secondary_primary '' + '''''''' + prm.primary_server + '''''', '''''' + prm.primary_database +  ''''''''   
from msdb.dbo.log_shipping_monitor_primary prm INNER JOIN msdb.dbo.log_shipping_primary_secondaries sec  ON  prm.primary_database=sec.secondary_database
where prm.primary_database in ( ' + @PriDB + ' )')

```

### <a name="restore-the-backups"></a><span data-ttu-id="26d6c-388">Restauration des sauvegardes</span><span class="sxs-lookup"><span data-stu-id="26d6c-388">Restore the backups</span></span>

<span data-ttu-id="26d6c-p150">Les sauvegardes doivent être restaurées dans l'ordre dans lequel elles ont été créées. Pour pouvoir restaurer une sauvegarde de journal des transactions en particulier, vous devez d'abord restaurer les sauvegardes précédentes ci-après sans restaurer les transactions non validées (c'est-à-dire, en utilisant  `WITH NORECOVERY`) :</span><span class="sxs-lookup"><span data-stu-id="26d6c-p150">Backups must be restored in the order in which they were created. Before you can restore a particular transaction log backup, you must first restore the following previous backups without rolling back uncommitted transactions (that is, by using  `WITH NORECOVERY`):</span></span>
  
- <span data-ttu-id="26d6c-p151">La sauvegarde complète de la base de données et la dernière sauvegarde différentielle : restaurez ces sauvegardes, le cas échéant, si elles ont été effectuées avant la sauvegarde du journal des transactions en particulier. Avant la création de la dernière sauvegarde complète ou différentielle de la base de données, la base de données utilisait le mode de récupération complète ou le mode de récupération utilisant les journaux de transactions.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p151">The full database backup and the last differential backup - Restore these backups, if any exist, taken before the particular transaction log backup. Before the most recent full or differential database backup was created, the database was using the full recovery model or bulk-logged recovery model.</span></span>
    
- <span data-ttu-id="26d6c-p152">Toutes les sauvegardes du journal des transactions : restaurez les sauvegardes du journal des transactions effectuées après la sauvegarde complète de la base de données ou la sauvegarde différentielle (si vous en restaurez une) et avant la sauvegarde du journal des transactions en particulier. Les sauvegardes de journaux doivent être appliquées dans l'ordre dans lequel elles ont été créées, sans interruption de la chaîne de journaux.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p152">All transaction log backups - Restore any transaction log backups taken after the full database backup or the differential backup (if you restore one) and before the particular transaction log backup. Log backups must be applied in the sequence in which they were created, without any gaps in the log chain.</span></span>
    
<span data-ttu-id="26d6c-p153">Pour récupérer la base de données de contenu sur le serveur secondaire de façon à afficher les sites, supprimez toutes les connexions de base de données avant la restauration. Pour restaurer la base de données, exécutez l’instruction SQL suivante.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p153">To recover the content database on the secondary server so that the sites render, remove all database connections before recovery. To restore the database, run the following SQL statement.</span></span>
  
```
restore database WSS_Content with recovery

```

> [!IMPORTANT]
> <span data-ttu-id="26d6c-p154">Lorsque vous utilisez explicitement T-SQL, spécifiez **WITH NORECOVERY** ou **WITH RECOVERY** dans chaque instruction RESTORE pour éliminer toute ambiguïté, ce qui est très important lors de l'écriture de scripts. Une fois les sauvegardes complètes et différentielles restaurées, les journaux des transactions peuvent être restaurés dans SQL Server Management Studio. Par ailleurs, puisque la copie des journaux de transaction est déjà arrêtée, la base de données de contenu est en attente, vous devez donc modifier cet état sur Accès total.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p154">When you use T-SQL explicitly, specify either **WITH NORECOVERY** or **WITH RECOVERY** in every RESTORE statement to eliminate ambiguity—this is very important when writing scripts. After the full and differential backups are restored, the transaction logs can be restored in SQL Server Management Studio. Also, because log shipping is already stopped, the content database is in a standby state, so you must change the state to full access.</span></span>
  
<span data-ttu-id="26d6c-p155">Dans SQL Server Management Studio, cliquez avec le bouton droit de la souris sur la base de données **WSS_Content**, pointez sur **Tâches** > **Restaurer**, puis cliquez sur **Journal des transactions** (si vous n'avez pas restauré la sauvegarde complète, cette option n'est pas disponible). Pour plus d'informations, voir [Restaurer une sauvegarde de journal des transactions (SQL Server)](/sql/relational-databases/backup-restore/restore-a-transaction-log-backup-sql-server).</span><span class="sxs-lookup"><span data-stu-id="26d6c-p155">In SQL Server Management Studio, right-click the **WSS_Content** database, point to **Tasks** > **Restore**, and then click **Transaction Log** (if you have not restored the full backup, this is not available). For more information, see[Restore a Transaction Log Backup (SQL Server)](/sql/relational-databases/backup-restore/restore-a-transaction-log-backup-sql-server).</span></span>
  
### <a name="crawl-the-content-source"></a><span data-ttu-id="26d6c-402">Analyse de la source de contenu</span><span class="sxs-lookup"><span data-stu-id="26d6c-402">Crawl the content source</span></span>

<span data-ttu-id="26d6c-p156">Vous devez démarrer une analyse complète pour chaque source de contenu afin de restaurer le service de recherche. Vous perdrez des informations d'analyse de la batterie de serveurs locale, par exemple les recommandations de recherche. Avant de commencer les analyses complètes, utilisez la cmdlet Windows PowerShell **Restore-SPEnterpriseSearchServiceApplication** et spécifiez la base de données des paramètres de recherche répliquée et dont les journaux de transaction ont été copiés, **Search_Service__DB_<GUID>**. Cette cmdlet fournit la configuration, le schéma, les propriétés gérées, les règles et les sources de recherche et crée un ensemble par défaut des autres composants.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p156">You must start a full crawl for each content source to restore the Search Service. Note that you lose some analytics information from the on-premises farm, such as search recommendations. Before you start the full crawls, use the Windows PowerShell cmdlet **Restore-SPEnterpriseSearchServiceApplication** and specify the log-shipped and replicated Search Administration database, **Search_Service__DB_<GUID>**. This cmdlet gives the search configuration, schema, managed properties, rules, and sources and creates a default set of the other components.</span></span>
  
<span data-ttu-id="26d6c-407">Pour démarrer une analyse complète, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="26d6c-407">To start a full crawl, complete the following steps:</span></span>
  
1. <span data-ttu-id="26d6c-408">Dans l'Administration centrale de SharePoint 2013, accédez à **Gestion des applications** > **Applications de service** > **Gérer les applications de service**, puis cliquez sur l'application de service de recherche que vous souhaitez analyser.</span><span class="sxs-lookup"><span data-stu-id="26d6c-408">In the SharePoint 2013 Central Administration, go to **Application Management** > **Service Applications** > **Manage service applications**, and then click the Search Service application that you want to crawl.</span></span>
    
2. <span data-ttu-id="26d6c-409">Sur la page **Administration de la recherche**, cliquez sur **Sources de contenu**, pointez sur la source de contenu que vous voulez analyser, cliquez sur la flèche, puis sur **Démarrer l'analyse complète**.</span><span class="sxs-lookup"><span data-stu-id="26d6c-409">On the **Search Administration** page, click **Content Sources**, point to the content source that you want, click the arrow, and then click **Start Full Crawl**.</span></span>
    
### <a name="recover-farm-services"></a><span data-ttu-id="26d6c-410">Récupération des services de batterie de serveurs</span><span class="sxs-lookup"><span data-stu-id="26d6c-410">Recover farm services</span></span>

<span data-ttu-id="26d6c-411">Le tableau suivant montre comment récupérer les services dotés de bases de données dont les journaux de transaction ont été copiés, les services dotés de bases de données mais dont la restauration à l’aide des journaux des transactions n’est pas recommandée et les services qui n’ont pas de bases de données.</span><span class="sxs-lookup"><span data-stu-id="26d6c-411">The following table shows how to recover services that have log-shipped databases, the services that have databases but are not recommended to restore with log shipping, and the services that do not have databases.</span></span>
  
> [!IMPORTANT]
> <span data-ttu-id="26d6c-412">La restauration d’une base de données SharePoint locale dans l’environnement Azure ne permet pas de récupérer les services SharePoint que vous n’avez pas déjà installés dans Azure manuellement.</span><span class="sxs-lookup"><span data-stu-id="26d6c-412">Restoring an on-premises SharePoint database into the Azure environment will not recover any SharePoint services that you did not already install in Azure manually.</span></span> 
  
<span data-ttu-id="26d6c-413">**Tableau : Référence de base de données d'application de service**</span><span class="sxs-lookup"><span data-stu-id="26d6c-413">**Table: Service application database reference**</span></span>

|<span data-ttu-id="26d6c-414">**Restaurer ces services à partir des bases de données dont les journaux de transaction ont été copiés**</span><span class="sxs-lookup"><span data-stu-id="26d6c-414">**Restore these services from log-shipped databases**</span></span>|<span data-ttu-id="26d6c-415">**Les services suivants ont des bases de données, mais il est recommandé de démarrer ces services sans restaurer leurs bases de données**</span><span class="sxs-lookup"><span data-stu-id="26d6c-415">**These services have databases, but we recommend that you start these services without restoring their databases**</span></span>|<span data-ttu-id="26d6c-416">**Les services suivants ne stockent pas de données dans des bases de données ; démarrez ces services après le basculement**</span><span class="sxs-lookup"><span data-stu-id="26d6c-416">**These services do not store data in databases; start these services after failover**</span></span>|
|:-----|:-----|:-----|
| <span data-ttu-id="26d6c-417">Service de traduction automatique</span><span class="sxs-lookup"><span data-stu-id="26d6c-417">Machine Translation Service</span></span> <br/>  <span data-ttu-id="26d6c-418">Service de métadonnées gérées</span><span class="sxs-lookup"><span data-stu-id="26d6c-418">Managed Metadata Service</span></span> <br/>  <span data-ttu-id="26d6c-419">Service Banque d’informations sécurisé</span><span class="sxs-lookup"><span data-stu-id="26d6c-419">Secure Store Service</span></span> <br/>  <span data-ttu-id="26d6c-p157">Profil utilisateur. (Seules les bases de données de profil et de liens de mise en réseau sont prises en charge. La base de données de synchronisation n’est pas prise en charge.)</span><span class="sxs-lookup"><span data-stu-id="26d6c-p157">User Profile. (Only the Profile and Social Tagging databases are supported. The Synchronization database is not supported.)</span></span> <br/>  <span data-ttu-id="26d6c-423">Service de paramètres d’abonnement Microsoft SharePoint Foundation</span><span class="sxs-lookup"><span data-stu-id="26d6c-423">Microsoft SharePoint Foundation Subscription Settings Service</span></span> <br/> | <span data-ttu-id="26d6c-424">Collecte de données relatives à l’utilisation et à l’état</span><span class="sxs-lookup"><span data-stu-id="26d6c-424">Usage and Health Data Collection</span></span> <br/>  <span data-ttu-id="26d6c-425">Service d’états temporaires</span><span class="sxs-lookup"><span data-stu-id="26d6c-425">State service</span></span> <br/>  <span data-ttu-id="26d6c-426">Word Automation</span><span class="sxs-lookup"><span data-stu-id="26d6c-426">Word automation</span></span> <br/> | <span data-ttu-id="26d6c-427">Excel Services</span><span class="sxs-lookup"><span data-stu-id="26d6c-427">Excel Services</span></span> <br/>  <span data-ttu-id="26d6c-428">PerformancePoint Services</span><span class="sxs-lookup"><span data-stu-id="26d6c-428">PerformancePoint Services</span></span> <br/>  <span data-ttu-id="26d6c-429">Conversion PowerPoint</span><span class="sxs-lookup"><span data-stu-id="26d6c-429">PowerPoint Conversion</span></span> <br/>  <span data-ttu-id="26d6c-430">Service Graphiques Visio</span><span class="sxs-lookup"><span data-stu-id="26d6c-430">Visio Graphics Service</span></span> <br/>  <span data-ttu-id="26d6c-431">Gestion du travail</span><span class="sxs-lookup"><span data-stu-id="26d6c-431">Work Management</span></span> <br/> |
   
<span data-ttu-id="26d6c-432">L’exemple suivant montre comment restaurer le service de métadonnées gérées à partir d’une base de données.</span><span class="sxs-lookup"><span data-stu-id="26d6c-432">The following example shows how to restore the Managed Metadata service from a database.</span></span>
  
<span data-ttu-id="26d6c-p158">Cet exemple utilise la base de donnéesManaged_Metadata_DBexistante. Les journaux de transaction de cette base de données sont copiés, mais comme aucune application de service n'est active sur la batterie de serveurs secondaire, la base de données doit être connectée après la mise en place de l'application de service.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p158">This uses the existing Managed_Metadata_DB database. This database is log shipped, but there is no active service application on the secondary farm, so it needs to be connected after the service application is in place.</span></span>
  
<span data-ttu-id="26d6c-435">Tout d'abord, utilisez  `New-SPMetadataServiceApplication` et spécifiez le commutateur `DatabaseName` avec le nom de la base de données restaurée.</span><span class="sxs-lookup"><span data-stu-id="26d6c-435">First, use  `New-SPMetadataServiceApplication`, and specify the  `DatabaseName` switch with the name of the restored database.</span></span>
  
<span data-ttu-id="26d6c-436">Configurez ensuite la nouvelle application de service de métadonnées gérées sur le serveur secondaire, comme suit :</span><span class="sxs-lookup"><span data-stu-id="26d6c-436">Next, configure the new Managed Metadata Service Application on the secondary server, as follows:</span></span>
  
- <span data-ttu-id="26d6c-437">Nom : service de métadonnées gérées</span><span class="sxs-lookup"><span data-stu-id="26d6c-437">Name: Managed Metadata Service</span></span>
    
- <span data-ttu-id="26d6c-438">Serveur de base de données : nom de la base de données du journal des transactions copié</span><span class="sxs-lookup"><span data-stu-id="26d6c-438">Database server: The database name from the shipped transaction log</span></span>
    
- <span data-ttu-id="26d6c-439">Nom de la base de donnéesManaged_Metadata_DB</span><span class="sxs-lookup"><span data-stu-id="26d6c-439">Database name: Managed_Metadata_DB</span></span>
    
- <span data-ttu-id="26d6c-440">Pool d'applications : applications de service SharePoint</span><span class="sxs-lookup"><span data-stu-id="26d6c-440">Application pool: SharePoint Service Applications</span></span> 
    
### <a name="manage-dns-records"></a><span data-ttu-id="26d6c-441">Gestion des enregistrements DNS</span><span class="sxs-lookup"><span data-stu-id="26d6c-441">Manage DNS records</span></span>

<span data-ttu-id="26d6c-442">Vous devez créer manuellement des enregistrements DNS pour qu’ils pointent vers votre batterie de serveurs SharePoint.</span><span class="sxs-lookup"><span data-stu-id="26d6c-442">You must manually create DNS records to point to your SharePoint farm.</span></span>
  
<span data-ttu-id="26d6c-p159">Dans la plupart des cas où vous avez plusieurs serveurs web frontaux, il est logique de tirer parti de la fonctionnalité d'équilibrage de la charge réseau dans Windows Server 2012 ou d'un équilibrage de la charge matérielle pour répartir les demandes entre les serveurs web frontaux dans votre batterie de serveurs. L'équilibrage de la charge réseau peut également permettre de réduire les risques en envoyant les requêtes vers les autres serveurs en cas de panne d'un de vos serveurs web frontaux.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p159">In most cases where you have multiple front-end web servers, it makes sense to take advantage of the Network Load Balancing feature in Windows Server 2012 or a hardware load balancer to distribute requests among the web-front-end servers in your farm. Network load balancing can also help reduce risk by distributing requests to the other servers if one of your web-front-end servers fails.</span></span> 
  
<span data-ttu-id="26d6c-p160">En règle générale, lorsque vous configurez l'équilibrage de la charge réseau, une adresse IP unique est attribuée à votre cluster. Vous créez ensuite un enregistrement d'hôte DNS dans le fournisseur DNS de votre réseau qui pointe vers le cluster. (Pour ce projet, nous mettons un serveur DNS dans Azure pour la résilience en cas de panne d'un centre de données local.) Par exemple, vous pouvez créer un enregistrement DNS, dans le gestionnaire DNS dans Active Directory, appelé  `https://sharepoint.contoso.com` et qui pointe vers l'adresse IP de votre cluster dont la charge est équilibrée.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p160">Typically, when you set up network load balancing, your cluster is assigned a single IP address. You then create a DNS host record in the DNS provider for your network that points to the cluster. (For this project, we put a DNS server in Azure for resiliency in case of an on-premises datacenter failure.) For instance, you can create a DNS record, in DNS Manager in Active Directory, for example, called  `https://sharepoint.contoso.com`, that points to the IP address for your load-balanced cluster.</span></span>
  
<span data-ttu-id="26d6c-448">Pour l’accès externe à votre batterie de serveurs SharePoint, vous pouvez créer un enregistrement d’hôte sur un serveur DNS externe avec la même URL que celle que les clients utilisent sur votre intranet (par exemple, ) qui pointe vers une adresse IP externe dans votre pare-feu. `https://sharepoint.contoso.com`</span><span class="sxs-lookup"><span data-stu-id="26d6c-448">For external access to your SharePoint farm, you can create a host record on an external DNS server with the same URL that clients use on your intranet (for example, `https://sharepoint.contoso.com`) that points to an external IP address in your firewall.</span></span> <span data-ttu-id="26d6c-449">(L’une des meilleures pratiques, à l’aide de cet exemple, consiste à configurer le DNS fractionnement afin que le serveur DNS interne fait autorité et route les demandes directement vers le cluster de la batterie de serveurs SharePoint, plutôt que de router les demandes DNS vers votre serveur `contoso.com` DNS externe.) Vous pouvez ensuite ma cartographier l’adresse IP externe sur l’adresse IP interne de votre cluster local afin que les clients trouvent les ressources qu’ils recherchent.</span><span class="sxs-lookup"><span data-stu-id="26d6c-449">(A best practice, using this example, is to set up split DNS so that the internal DNS server is authoritative for `contoso.com` and routes requests directly to the SharePoint farm cluster, rather than routing DNS requests to your external DNS server.) You can then map the external IP address to the internal IP address of your on-premises cluster so that clients find the resources they are looking for.</span></span>
  
<span data-ttu-id="26d6c-450">À ce stade, vous pouvez rencontrer deux scénarios de récupération d’urgence :</span><span class="sxs-lookup"><span data-stu-id="26d6c-450">From here, you might run into a couple of different disaster-recovery scenarios:</span></span>
  
 <span data-ttu-id="26d6c-p162">**Exemple de scénario : la batterie de serveurs SharePoint locale n'est pas disponible en raison d'une panne matérielle dans la batterie de serveurs SharePoint locale.** Dans ce cas, après avoir terminé la procédure de basculement vers la batterie de serveurs SharePoint Azure, vous pouvez configurer un équilibrage de la charge réseau sur les serveurs web frontaux de la batterie de serveurs SharePoint de récupération, comme vous l'aviez fait avec la batterie de serveurs locale. Vous pouvez ensuite rediriger l'enregistrement d'hôte de votre fournisseur DNS interne afin qu'il pointe vers l'adresse IP de cluster de la batterie de récupération. Le processus visant à actualiser les enregistrements DNS mis en cache sur les clients et à les faire pointer vers la batterie de serveurs de récupération peut prendre un certain temps.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p162">**Example scenario: The on-premises SharePoint farm is unavailable because of hardware failure in the on-premises SharePoint farm.** In this case, after you have completed the steps for failover to the Azure SharePoint farm, you can configure network load balancing on the recovery SharePoint farm's web-front-end servers, the same way you did with the on-premises farm. You can then redirect the host record in your internal DNS provider to point to the recovery farm's cluster IP address. Note that it can take some time before cached DNS records on clients are refreshed and point to the recovery farm.</span></span>
  
 <span data-ttu-id="26d6c-p163">**Exemple de scénario : le centre de données local est entièrement perdu.** Ce scénario peut se produire suite à une catastrophe naturelle, par exemple un incendie ou une inondation. Dans ce cas, une entreprise aura probablement un centre de données secondaire hébergé dans une autre région, ainsi qu'un sous-réseau Azure possédant ses propres services d'annuaire et DNS. Comme dans le scénario d'urgence précédent, vous pouvez rediriger vos enregistrements DNS internes et externes afin qu'ils pointent vers la batterie de serveurs SharePoint Azure. Là encore, la propagation des enregistrements DNS peut prendre un certain temps.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p163">**Example scenario: The on-premises datacenter is lost completely.** This scenario might occur due to a natural disaster, such as a fire or flood. In this case, for an enterprise, you would likely have a secondary datacenter hosted in another region as well as your Azure subnet that has its own directory services and DNS. As in the previous disaster scenario, you can redirect your internal and external DNS records to point to the Azure SharePoint farm. Again, take note that DNS-record propagation can take some time.</span></span>
  
<span data-ttu-id="26d6c-460">Si vous utilisez des collections de sites nommées par l’hôte, comme recommandé dans l’architecture et le déploiement d’une collection de sites nommée par l’hôte [(SharePoint 2013),](/SharePoint/administration/host-named-site-collection-architecture-and-deployment)vous pouvez avoir plusieurs collections de sites hébergées par la même application web dans votre batterie de serveurs SharePoint, avec des noms DNS uniques (par exemple, `https://sales.contoso.com` et `https://marketing.contoso.com` ).</span><span class="sxs-lookup"><span data-stu-id="26d6c-460">If you are using host-named site collections, as recommended in [Host-named site collection architecture and deployment (SharePoint 2013)](/SharePoint/administration/host-named-site-collection-architecture-and-deployment), you might have several site collections hosted by the same web application in your SharePoint farm, with unique DNS names (for example, `https://sales.contoso.com` and `https://marketing.contoso.com`).</span></span> <span data-ttu-id="26d6c-461">Dans ce cas, vous pouvez créer des enregistrements DNS pour chaque collection de sites qui pointe vers l'adresse IP de votre cluster.</span><span class="sxs-lookup"><span data-stu-id="26d6c-461">In this case, you can create DNS records for each site collection that point to your cluster IP address.</span></span> <span data-ttu-id="26d6c-462">Lorsqu'une requête atteint vos serveurs web frontaux SharePoint, ces derniers acheminent chaque requête vers la collection de sites appropriée.</span><span class="sxs-lookup"><span data-stu-id="26d6c-462">After a request reaches your SharePoint web-front-end servers, they handle routing each request to the appropriate site collection.</span></span>
  
## <a name="microsoft-proof-of-concept-environment"></a><span data-ttu-id="26d6c-463">Environnement de preuve de concept Microsoft</span><span class="sxs-lookup"><span data-stu-id="26d6c-463">Microsoft proof-of-concept environment</span></span>

<span data-ttu-id="26d6c-p165">Nous avons conçu et testé un environnement de preuve de concept pour cette solution. L’objectif de conception pour notre environnement de test était de déployer et de récupérer une batterie de serveurs SharePoint qui pourrait se trouver dans un environnement client. Nous avons émis plusieurs hypothèses, mais nous savions que la batterie de serveurs devait fournir toutes les fonctionnalités prêtes à l’emploi sans aucune personnalisation. La topologie a été conçue pour une haute disponibilité à l’aide des meilleures pratiques du terrain et du groupe de produits.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p165">We designed and tested a proof-of-concept environment for this solution. The design goal for our test environment was to deploy and recover a SharePoint farm that we might find in a customer environment. We made several assumptions, but we knew that the farm needed to provide all of the out-of-the-box functionality without any customizations. The topology was designed for high availability by using best practice guidance from the field and product group.</span></span>
  
<span data-ttu-id="26d6c-468">Le tableau suivant décrit les machines virtuelles Hyper-V que nous avons créées et configurées pour l'environnement de test local.</span><span class="sxs-lookup"><span data-stu-id="26d6c-468">The following table describes the Hyper-V virtual machines that we created and configured for the on-premises test environment.</span></span>
  
<span data-ttu-id="26d6c-469">**Tableau : Machines virtuelles pour le test local**</span><span class="sxs-lookup"><span data-stu-id="26d6c-469">**Table: Virtual machines for on-premises test**</span></span>

|<span data-ttu-id="26d6c-470">**Nom du serveur**</span><span class="sxs-lookup"><span data-stu-id="26d6c-470">**Server name**</span></span>|<span data-ttu-id="26d6c-471">**Rôle**</span><span class="sxs-lookup"><span data-stu-id="26d6c-471">**Role**</span></span>|<span data-ttu-id="26d6c-472">**Configuration**</span><span class="sxs-lookup"><span data-stu-id="26d6c-472">**Configuration**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="26d6c-473">DC1</span><span class="sxs-lookup"><span data-stu-id="26d6c-473">DC1</span></span>  <br/> |<span data-ttu-id="26d6c-474">Contrôleur de domaine avec Active Directory.</span><span class="sxs-lookup"><span data-stu-id="26d6c-474">Domain controller with Active Directory.</span></span>  <br/> |<span data-ttu-id="26d6c-475">Deux processeurs</span><span class="sxs-lookup"><span data-stu-id="26d6c-475">Two processors</span></span>  <br/> <span data-ttu-id="26d6c-476">De 512 Mo à 4 Go de RAM</span><span class="sxs-lookup"><span data-stu-id="26d6c-476">From 512 MB through 4 GB of RAM</span></span>  <br/> <span data-ttu-id="26d6c-477">1 disque dur de 127 Go</span><span class="sxs-lookup"><span data-stu-id="26d6c-477">1 x 127-GB hard disk</span></span>  <br/> |
|<span data-ttu-id="26d6c-478">RRAS</span><span class="sxs-lookup"><span data-stu-id="26d6c-478">RRAS</span></span>  <br/> |<span data-ttu-id="26d6c-479">Serveur configuré avec le rôle Service Routage et accès distant (RRAS).</span><span class="sxs-lookup"><span data-stu-id="26d6c-479">Server configured with the Routing and Remote Access Service (RRAS) role.</span></span>  <br/> |<span data-ttu-id="26d6c-480">Deux processeurs</span><span class="sxs-lookup"><span data-stu-id="26d6c-480">Two processors</span></span>  <br/> <span data-ttu-id="26d6c-481">De 2 à 8 Go de RAM</span><span class="sxs-lookup"><span data-stu-id="26d6c-481">2-8 GB of RAM</span></span>  <br/> <span data-ttu-id="26d6c-482">1 disque dur de 127 Go</span><span class="sxs-lookup"><span data-stu-id="26d6c-482">1 x 127-GB hard disk</span></span>  <br/> |
|<span data-ttu-id="26d6c-483">FS1</span><span class="sxs-lookup"><span data-stu-id="26d6c-483">FS1</span></span>  <br/> |<span data-ttu-id="26d6c-484">Serveur de fichiers avec des partages pour les sauvegardes et un point de terminaison pour la réplication DFS.</span><span class="sxs-lookup"><span data-stu-id="26d6c-484">File server with shares for backups and an end point for DFSR.</span></span>  <br/> |<span data-ttu-id="26d6c-485">Quatre processeurs</span><span class="sxs-lookup"><span data-stu-id="26d6c-485">Four processors</span></span>  <br/> <span data-ttu-id="26d6c-486">De 2 à 12 Go de RAM</span><span class="sxs-lookup"><span data-stu-id="26d6c-486">2-12 GB of RAM</span></span>  <br/> <span data-ttu-id="26d6c-487">1 disque dur de 127 Go</span><span class="sxs-lookup"><span data-stu-id="26d6c-487">1 x 127-GB hard disk</span></span>  <br/> <span data-ttu-id="26d6c-488">1 disque dur de 1 To (SAN)</span><span class="sxs-lookup"><span data-stu-id="26d6c-488">1 x 1-TB hard disk (SAN)</span></span>  <br/> <span data-ttu-id="26d6c-489">1 disque dur de 750 Go</span><span class="sxs-lookup"><span data-stu-id="26d6c-489">1 x 750-GB hard disk</span></span>  <br/> |
|<span data-ttu-id="26d6c-490">SP-WFE1, SP-WFE2</span><span class="sxs-lookup"><span data-stu-id="26d6c-490">SP-WFE1, SP-WFE2</span></span>  <br/> |<span data-ttu-id="26d6c-491">Serveurs web frontaux.</span><span class="sxs-lookup"><span data-stu-id="26d6c-491">Front-end web servers.</span></span>  <br/> |<span data-ttu-id="26d6c-492">Quatre processeurs</span><span class="sxs-lookup"><span data-stu-id="26d6c-492">Four processors</span></span>  <br/> <span data-ttu-id="26d6c-493">16 Go de RAM</span><span class="sxs-lookup"><span data-stu-id="26d6c-493">16 GB of RAM</span></span>  <br/> |
|<span data-ttu-id="26d6c-494">SP-APP1, SP-APP2, SP-APP3</span><span class="sxs-lookup"><span data-stu-id="26d6c-494">SP-APP1, SP-APP2, SP-APP3</span></span>  <br/> |<span data-ttu-id="26d6c-495">Serveurs d’applications.</span><span class="sxs-lookup"><span data-stu-id="26d6c-495">Application servers.</span></span>  <br/> |<span data-ttu-id="26d6c-496">Quatre processeurs</span><span class="sxs-lookup"><span data-stu-id="26d6c-496">Four processors</span></span>  <br/> <span data-ttu-id="26d6c-497">De 2 à 16 Go de RAM</span><span class="sxs-lookup"><span data-stu-id="26d6c-497">2-16 GB of RAM</span></span>  <br/> |
|<span data-ttu-id="26d6c-498">SP-SQL-HA1, SP-SQL-HA2</span><span class="sxs-lookup"><span data-stu-id="26d6c-498">SP-SQL-HA1, SP-SQL-HA2</span></span>  <br/> |<span data-ttu-id="26d6c-p166">Serveurs de base de données configurés avec les groupes de disponibilité AlwaysOn SQL Server 2012 pour fournir une haute disponibilité. Cette configuration utilise SP-SQL-HA1 et SP-SQL-HA2 comme réplicas principal et secondaire.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p166">Database servers, configured with SQL Server 2012 AlwaysOn availability groups to provide high availability. This configuration uses SP-SQL-HA1 and SP-SQL-HA2 as the primary and secondary replicas.</span></span>  <br/> |<span data-ttu-id="26d6c-501">Quatre processeurs</span><span class="sxs-lookup"><span data-stu-id="26d6c-501">Four processors</span></span>  <br/> <span data-ttu-id="26d6c-502">De 2 à 16 Go de RAM</span><span class="sxs-lookup"><span data-stu-id="26d6c-502">2-16 GB of RAM</span></span>  <br/> |
   
<span data-ttu-id="26d6c-503">Le tableau suivant décrit les configurations des lecteurs pour les machines virtuelles Hyper-V que nous avons créées et configurées pour les serveurs web frontaux et les serveurs d'applications pour l'environnement de test local.</span><span class="sxs-lookup"><span data-stu-id="26d6c-503">The following table describes drive configurations for the Hyper-V virtual machines that we created and configured for the front-end web and application servers for the on-premises test environment.</span></span>
  
<span data-ttu-id="26d6c-504">**Tableau : Configurations requises des lecteurs des machines virtuelles pour les serveurs web frontaux et les serveurs d'applications pour le test local**</span><span class="sxs-lookup"><span data-stu-id="26d6c-504">**Table: Virtual machine drive requirements for the Front End Web and Application servers for the on-premises test**</span></span>

|<span data-ttu-id="26d6c-505">**Lettre du lecteur**</span><span class="sxs-lookup"><span data-stu-id="26d6c-505">**Drive letter**</span></span>|<span data-ttu-id="26d6c-506">**Taille**</span><span class="sxs-lookup"><span data-stu-id="26d6c-506">**Size**</span></span>|<span data-ttu-id="26d6c-507">**Nom de répertoire**</span><span class="sxs-lookup"><span data-stu-id="26d6c-507">**Directory name**</span></span>|<span data-ttu-id="26d6c-508">**Chemin**</span><span class="sxs-lookup"><span data-stu-id="26d6c-508">**Path**</span></span>|
|:-----|:-----|:-----|:-----|
|<span data-ttu-id="26d6c-509">C</span><span class="sxs-lookup"><span data-stu-id="26d6c-509">C</span></span>  <br/> |<span data-ttu-id="26d6c-510">80</span><span class="sxs-lookup"><span data-stu-id="26d6c-510">80</span></span>  <br/> |<span data-ttu-id="26d6c-511">Lecteur système</span><span class="sxs-lookup"><span data-stu-id="26d6c-511">System drive</span></span>  <br/> |<span data-ttu-id="26d6c-512"><DriveLetter>:\\Program Files\\Microsoft SQL Server</span><span class="sxs-lookup"><span data-stu-id="26d6c-512"><DriveLetter>:\\Program Files\\Microsoft SQL Server</span></span>\\  <br/> |
|<span data-ttu-id="26d6c-513">E</span><span class="sxs-lookup"><span data-stu-id="26d6c-513">E</span></span>  <br/> |<span data-ttu-id="26d6c-514">80</span><span class="sxs-lookup"><span data-stu-id="26d6c-514">80</span></span>  <br/> |<span data-ttu-id="26d6c-515">Lecteur de journaux (40 Go)</span><span class="sxs-lookup"><span data-stu-id="26d6c-515">Log drive (40 GB)</span></span>  <br/> |<span data-ttu-id="26d6c-516"><DriveLetter>:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA</span><span class="sxs-lookup"><span data-stu-id="26d6c-516"><DriveLetter>:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA</span></span>  <br/> |
|<span data-ttu-id="26d6c-517">F</span><span class="sxs-lookup"><span data-stu-id="26d6c-517">F</span></span>  <br/> |<span data-ttu-id="26d6c-518">80</span><span class="sxs-lookup"><span data-stu-id="26d6c-518">80</span></span>  <br/> |<span data-ttu-id="26d6c-519">Page (36 Go)</span><span class="sxs-lookup"><span data-stu-id="26d6c-519">Page (36 GB)</span></span>  <br/> |<span data-ttu-id="26d6c-520"><DriveLetter>:\\Program Files\\Microsoft SQL Server\\MSSQL\\DATA</span><span class="sxs-lookup"><span data-stu-id="26d6c-520"><DriveLetter>:\\Program Files\\Microsoft SQL Server\\MSSQL\\DATA</span></span>  <br/> |
   
<span data-ttu-id="26d6c-p167">Le tableau suivant décrit les configurations des lecteurs pour les machines virtuelles Hyper-V créées et configurées en tant que serveurs de base de données locaux. Sur la page **Configuration du moteur de base de données**, accédez à l'onglet **Répertoires de données** pour définir et confirmer les paramètres indiqués dans le tableau suivant.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p167">The following table describes drive configurations for the Hyper-V virtual machines created and configured to serve as the on-premises database servers. On the **Database Engine Configuration** page, access the **Data Directories** tab to set and confirm the settings shown in the following table.</span></span>
  
<span data-ttu-id="26d6c-523">**Tableau : Configurations requises des lecteurs des machines virtuelles pour le serveur de base de données pour le test local**</span><span class="sxs-lookup"><span data-stu-id="26d6c-523">**Table: Virtual machine drive requirements for the database server for the on-premises test**</span></span>

|<span data-ttu-id="26d6c-524">**Lettre du lecteur**</span><span class="sxs-lookup"><span data-stu-id="26d6c-524">**Drive letter**</span></span>|<span data-ttu-id="26d6c-525">**Taille**</span><span class="sxs-lookup"><span data-stu-id="26d6c-525">**Size**</span></span>|<span data-ttu-id="26d6c-526">**Nom de répertoire**</span><span class="sxs-lookup"><span data-stu-id="26d6c-526">**Directory name**</span></span>|<span data-ttu-id="26d6c-527">**Chemin**</span><span class="sxs-lookup"><span data-stu-id="26d6c-527">**Path**</span></span>|
|:-----|:-----|:-----|:-----|
|<span data-ttu-id="26d6c-528">C</span><span class="sxs-lookup"><span data-stu-id="26d6c-528">C</span></span>  <br/> |<span data-ttu-id="26d6c-529">80</span><span class="sxs-lookup"><span data-stu-id="26d6c-529">80</span></span>  <br/> |<span data-ttu-id="26d6c-530">Répertoire racine de données</span><span class="sxs-lookup"><span data-stu-id="26d6c-530">Data root directory</span></span>  <br/> |<span data-ttu-id="26d6c-531"><DriveLetter>:\\Program Files\\Microsoft SQL Server</span><span class="sxs-lookup"><span data-stu-id="26d6c-531"><DriveLetter>:\\Program Files\\Microsoft SQL Server</span></span>\\  <br/> |
|<span data-ttu-id="26d6c-532">E</span><span class="sxs-lookup"><span data-stu-id="26d6c-532">E</span></span>  <br/> |<span data-ttu-id="26d6c-533">500</span><span class="sxs-lookup"><span data-stu-id="26d6c-533">500</span></span>  <br/> |<span data-ttu-id="26d6c-534">Répertoire de base de données utilisateur</span><span class="sxs-lookup"><span data-stu-id="26d6c-534">User database directory</span></span>  <br/> |<span data-ttu-id="26d6c-535"><DriveLetter>:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA</span><span class="sxs-lookup"><span data-stu-id="26d6c-535"><DriveLetter>:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA</span></span>  <br/> |
|<span data-ttu-id="26d6c-536">F</span><span class="sxs-lookup"><span data-stu-id="26d6c-536">F</span></span>  <br/> |<span data-ttu-id="26d6c-537">500</span><span class="sxs-lookup"><span data-stu-id="26d6c-537">500</span></span>  <br/> |<span data-ttu-id="26d6c-538">Répertoire de journal de base de données utilisateur</span><span class="sxs-lookup"><span data-stu-id="26d6c-538">User database log directory</span></span>  <br/> |<span data-ttu-id="26d6c-539"><DriveLetter>:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA</span><span class="sxs-lookup"><span data-stu-id="26d6c-539"><DriveLetter>:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA</span></span>  <br/> |
|<span data-ttu-id="26d6c-540">G</span><span class="sxs-lookup"><span data-stu-id="26d6c-540">G</span></span>  <br/> |<span data-ttu-id="26d6c-541">500</span><span class="sxs-lookup"><span data-stu-id="26d6c-541">500</span></span>  <br/> |<span data-ttu-id="26d6c-542">Répertoire de base de données temporaire</span><span class="sxs-lookup"><span data-stu-id="26d6c-542">Temp DB directory</span></span>  <br/> |<span data-ttu-id="26d6c-543"><DriveLetter>:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA</span><span class="sxs-lookup"><span data-stu-id="26d6c-543"><DriveLetter>:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA</span></span>  <br/> |
|<span data-ttu-id="26d6c-544">H</span><span class="sxs-lookup"><span data-stu-id="26d6c-544">H</span></span>  <br/> |<span data-ttu-id="26d6c-545">500</span><span class="sxs-lookup"><span data-stu-id="26d6c-545">500</span></span>  <br/> |<span data-ttu-id="26d6c-546">Répertoire de journal de base de données temporaire</span><span class="sxs-lookup"><span data-stu-id="26d6c-546">Temp DB log directory</span></span>  <br/> |<span data-ttu-id="26d6c-547"><DriveLetter>:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA</span><span class="sxs-lookup"><span data-stu-id="26d6c-547"><DriveLetter>:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA</span></span>  <br/> |
   
### <a name="setting-up-the-test-environment"></a><span data-ttu-id="26d6c-548">Configuration de l’environnement de test</span><span class="sxs-lookup"><span data-stu-id="26d6c-548">Setting up the test environment</span></span>

<span data-ttu-id="26d6c-p168">Au cours des différentes étapes du déploiement, l'équipe de test a d'abord travaillé sur l'architecture locale, puis sur l'environnement Azure correspondant. Cette approche reflète les situations réelles générales dans lesquelles les batteries de serveurs de production internes sont déjà exécutées. Il est encore plus important de connaître la charge de travail, la capacité et les performances types actuelles en production. Outre la création d'un modèle de récupération d'urgence satisfaisant aux besoins de l'entreprise, vous devez décider de la taille des serveurs de la batterie de récupération de façon à fournir un niveau de service minimal. Dans un environnement à reprise progressive ou semi-automatique, la taille de la batterie de serveurs de récupération est généralement plus petite que celle d'une batterie de serveurs de production. Une fois la batterie de serveurs de récupération exécutée en production, la taille des instances de la batterie peut être augmentée pour répondre aux exigences de charge de travail.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p168">During the different deployment phases, the test team typically worked on the on-premises architecture first and then on the corresponding Azure environment. This reflects the general real-world cases where in-house production farms are already running. What is even more important is that you should know the current production workload, capacity, and typical performance. In addition to building a disaster recovery model that can meet business requirements, you should size the recovery farm servers to deliver a minimum level of service. In a cold or warm standby environment, a recovery farm is typically smaller than a production farm. After the recovery farm is stable and in production, the farm can be scaled up and out to meet workload requirements.</span></span>
  
<span data-ttu-id="26d6c-555">Nous avons déployé notre environnement de test en trois étapes :</span><span class="sxs-lookup"><span data-stu-id="26d6c-555">We deployed our test environment in the following three phases:</span></span>
  
- <span data-ttu-id="26d6c-556">Configuration de l’infrastructure hybride</span><span class="sxs-lookup"><span data-stu-id="26d6c-556">Set up the hybrid infrastructure</span></span>
    
- <span data-ttu-id="26d6c-557">Configuration de serveurs</span><span class="sxs-lookup"><span data-stu-id="26d6c-557">Provision the servers</span></span>
    
- <span data-ttu-id="26d6c-558">Déploiement des batteries de serveurs SharePoint</span><span class="sxs-lookup"><span data-stu-id="26d6c-558">Deploy the SharePoint farms</span></span>
    
#### <a name="set-up-the-hybrid-infrastructure"></a><span data-ttu-id="26d6c-559">Configuration de l’infrastructure hybride</span><span class="sxs-lookup"><span data-stu-id="26d6c-559">Set up the hybrid infrastructure</span></span>

<span data-ttu-id="26d6c-p169">Cette étape implique la configuration d'un environnement de domaine pour la batterie de serveurs locale et pour la batterie de serveurs de récupération dans Azure. Outre les tâches normales associées à la configuration d'Active Directory, l'équipe de test a implémenté une solution de routage et une connexion VPN entre les deux environnements.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p169">This phase involved setting up a domain environment for the on-premises farm and for the recovery farm in Azure. In addition to the normal tasks associated with configuring Active Directory, the test team implemented a routing solution and a VPN connection between the two environments.</span></span>
  
#### <a name="provision-the-servers"></a><span data-ttu-id="26d6c-562">Configuration de serveurs</span><span class="sxs-lookup"><span data-stu-id="26d6c-562">Provision the servers</span></span>

<span data-ttu-id="26d6c-p170">Outre les serveurs de la batterie, il était nécessaire de configurer des serveurs pour les contrôleurs de domaine, ainsi qu’un serveur pour gérer RRAS et la connexion VPN de site à site. Deux serveurs de fichiers ont été configurés pour le service DFSR et plusieurs ordinateurs clients ont été configurés pour les testeurs.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p170">In addition to the farm servers, it was necessary to provision servers for the domain controllers and configure a server to handle RRAS as well as the site-to-site VPN. Two file servers were provisioned for the DFSR service, and several client computers were provisioned for testers.</span></span>
  
#### <a name="deploy-the-sharepoint-farms"></a><span data-ttu-id="26d6c-565">Déploiement des batteries de serveurs SharePoint</span><span class="sxs-lookup"><span data-stu-id="26d6c-565">Deploy the SharePoint farms</span></span>

<span data-ttu-id="26d6c-p171">Les batteries de serveurs SharePoint ont été déployées en deux étapes afin de simplifier la stabilisation de l’environnement et la résolution des problèmes, le cas échéant. Pendant la première étape, chaque batterie de serveurs a été déployée sur le nombre minimal de serveurs pour chaque niveau de la topologie afin de prendre en charge les fonctionnalités requises.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p171">The SharePoint farms were deployed in two stages in order to simplify environment stabilization and troubleshooting, if required. During the first stage, each farm was deployed on the minimum number of servers for each tier of the topology to support the required functionality.</span></span>
  
<span data-ttu-id="26d6c-p172">Nous avons créé les serveurs de base de données alors que SQL Server avait été installé avant la création des serveurs SharePoint 2013. Puisqu'il s'agissait d'un nouveau déploiement, nous avons constitué les groupes de disponibilité avant de déployer SharePoint. Nous avons créé trois groupes selon les meilleures pratiques MCS.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p172">We created the database servers with SQL Server installed before creating the SharePoint 2013 servers. Because this was a new deployment, we created the availability groups before deploying SharePoint. We created three groups based on MCS best practice guidance.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="26d6c-p173">Créez des bases de données d'espaces réservés afin de pouvoir constituer des groupes de disponibilité avant l'installation de SharePoint. Pour plus d'informations, voir [Configurer des groupes de disponibilité AlwaysOn SQL Server 2012 pour SharePoint 2013](/SharePoint/administration/configure-an-alwayson-availability-group)</span><span class="sxs-lookup"><span data-stu-id="26d6c-p173">Create placeholder databases so that you can create availability groups before the SharePoint installation. For more information, see [Configure SQL Server 2012 AlwaysOn Availability Groups for SharePoint 2013](/SharePoint/administration/configure-an-alwayson-availability-group)</span></span>
  
<span data-ttu-id="26d6c-573">Nous avons créé la batterie de serveurs et ajouté des serveurs supplémentaires dans l’ordre suivant :</span><span class="sxs-lookup"><span data-stu-id="26d6c-573">We created the farm and joined additional servers in the following order:</span></span>
  
- <span data-ttu-id="26d6c-574">Configuration de SP-SQL-HA1 et SP-SQL-HA2.</span><span class="sxs-lookup"><span data-stu-id="26d6c-574">Provision SP-SQL-HA1 and SP-SQL-HA2.</span></span>
    
- <span data-ttu-id="26d6c-575">Configuration d’AlwaysOn et création des trois groupes de disponibilité pour la batterie de serveurs.</span><span class="sxs-lookup"><span data-stu-id="26d6c-575">Configure AlwaysOn and create the three availability groups for the farm.</span></span> 
    
- <span data-ttu-id="26d6c-576">Configuration de SP-APP1 pour héberger l’Administration centrale.</span><span class="sxs-lookup"><span data-stu-id="26d6c-576">Provision SP-APP1 to host Central Administration.</span></span>
    
- <span data-ttu-id="26d6c-577">Configuration de SP-WFE1 et SP-WFE2 pour héberger le cache distribué.</span><span class="sxs-lookup"><span data-stu-id="26d6c-577">Provision SP-WFE1 and SP-WFE2 to host the distributed cache.</span></span> 
    
<span data-ttu-id="26d6c-578">Nous avons utilisé le paramètre  _skipRegisterAsDistributedCachehost_ lorsque nous avons exécuté **psconfig.exe** sur la ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="26d6c-578">We used the  _skipRegisterAsDistributedCachehost_ parameter when we ran **psconfig.exe** at the command line.</span></span> <span data-ttu-id="26d6c-579">Pour plus d'informations, voir [Planifier les flux et le service de cache distribué dans SharePoint Server 2013](/sharepoint/administration/plan-for-feeds-and-the-distributed-cache-service).</span><span class="sxs-lookup"><span data-stu-id="26d6c-579">For more information, see [Plan for feeds and the Distributed Cache service in SharePoint Server 2013](/sharepoint/administration/plan-for-feeds-and-the-distributed-cache-service).</span></span> 
  
<span data-ttu-id="26d6c-580">Nous avons répété les étapes suivantes dans l’environnement de récupération :</span><span class="sxs-lookup"><span data-stu-id="26d6c-580">We repeated the following steps in the recovery environment:</span></span>
  
- <span data-ttu-id="26d6c-581">Configuration d’AZ-SQL-HA1 et AZ-SQL-HA2.</span><span class="sxs-lookup"><span data-stu-id="26d6c-581">Provision AZ-SQL-HA1 and AZ-SQL-HA2.</span></span>
    
- <span data-ttu-id="26d6c-582">Configuration d’AlwaysOn et création des trois groupes de disponibilité pour la batterie de serveurs.</span><span class="sxs-lookup"><span data-stu-id="26d6c-582">Configure AlwaysOn and create the three availability groups for the farm.</span></span>
    
- <span data-ttu-id="26d6c-583">Configuration d’AZ-APP1 pour héberger l’Administration centrale.</span><span class="sxs-lookup"><span data-stu-id="26d6c-583">Provision AZ-APP1 to host Central Administration.</span></span>
    
- <span data-ttu-id="26d6c-584">Configuration d’AZ-WFE1 et d’AZ-WFE2 pour héberger le cache distribué.</span><span class="sxs-lookup"><span data-stu-id="26d6c-584">Provision AZ-WFE1 and AZ-WFE2 to host the distributed cache.</span></span>
    
<span data-ttu-id="26d6c-p175">Après avoir configuré le cache distribué et ajouté les utilisateurs test et le contenu de test, nous avons commencé la deuxième étape du déploiement. Cette opération nécessitait d’augmenter la taille des niveaux et de configurer les serveurs de la batterie pour qu’ils prennent en charge la topologie à haute disponibilité décrite dans l’architecture de la batterie de serveurs.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p175">After we configured the distributed cache and added test users and test content, we started stage two of the deployment. This required scaling out the tiers and configuring the farm servers to support the high-availability topology described in the farm architecture.</span></span>
  
<span data-ttu-id="26d6c-587">Le tableau suivant décrit les machines virtuelles, les sous-réseaux et les groupes à haute disponibilité que nous avons configurés pour notre batterie de serveurs de récupération.</span><span class="sxs-lookup"><span data-stu-id="26d6c-587">The following table describes the virtual machines, subnets, and availability sets we set up for our recovery farm.</span></span>
  
<span data-ttu-id="26d6c-588">**Tableau : Infrastructure de la batterie de serveurs de récupération**</span><span class="sxs-lookup"><span data-stu-id="26d6c-588">**Table: Recovery farm infrastructure**</span></span>

|<span data-ttu-id="26d6c-589">**Nom du serveur**</span><span class="sxs-lookup"><span data-stu-id="26d6c-589">**Server name**</span></span>|<span data-ttu-id="26d6c-590">**Rôle**</span><span class="sxs-lookup"><span data-stu-id="26d6c-590">**Role**</span></span>|<span data-ttu-id="26d6c-591">**Configuration**</span><span class="sxs-lookup"><span data-stu-id="26d6c-591">**Configuration**</span></span>|<span data-ttu-id="26d6c-592">**Sous-réseau**</span><span class="sxs-lookup"><span data-stu-id="26d6c-592">**Subnet**</span></span>|<span data-ttu-id="26d6c-593">**Groupes à haute disponibilité**</span><span class="sxs-lookup"><span data-stu-id="26d6c-593">**Availability set**</span></span>|
|:-----|:-----|:-----|:-----|:-----|
|<span data-ttu-id="26d6c-594">spDRAD</span><span class="sxs-lookup"><span data-stu-id="26d6c-594">spDRAD</span></span>  <br/> |<span data-ttu-id="26d6c-595">Contrôleur de domaine Active Directory</span><span class="sxs-lookup"><span data-stu-id="26d6c-595">Domain controller with Active Directory</span></span>  <br/> |<span data-ttu-id="26d6c-596">Deux processeurs</span><span class="sxs-lookup"><span data-stu-id="26d6c-596">Two processors</span></span>  <br/> <span data-ttu-id="26d6c-597">De 512 Mo à 4 Go de RAM</span><span class="sxs-lookup"><span data-stu-id="26d6c-597">From 512 MB through 4 GB of RAM</span></span>  <br/> <span data-ttu-id="26d6c-598">1 disque dur de 127 Go</span><span class="sxs-lookup"><span data-stu-id="26d6c-598">1 x 127-GB hard disk</span></span>  <br/> |<span data-ttu-id="26d6c-599">sp-ADservers</span><span class="sxs-lookup"><span data-stu-id="26d6c-599">sp-ADservers</span></span>  <br/> ||
|<span data-ttu-id="26d6c-600">AZ-SP-FS</span><span class="sxs-lookup"><span data-stu-id="26d6c-600">AZ-SP-FS</span></span>  <br/> |<span data-ttu-id="26d6c-601">Serveur de fichiers avec des partages pour les sauvegardes et un point de terminaison pour la réplication DFS</span><span class="sxs-lookup"><span data-stu-id="26d6c-601">File server with shares for backups and an endpoint for DFSR</span></span>  <br/> | <span data-ttu-id="26d6c-602">Configuration A5 :</span><span class="sxs-lookup"><span data-stu-id="26d6c-602">A5 configuration:</span></span> <br/>  <span data-ttu-id="26d6c-603">Deux processeurs</span><span class="sxs-lookup"><span data-stu-id="26d6c-603">Two processors</span></span> <br/>  <span data-ttu-id="26d6c-604">14 Go de RAM</span><span class="sxs-lookup"><span data-stu-id="26d6c-604">14 GB of RAM</span></span> <br/>  <span data-ttu-id="26d6c-605">1 disque dur de 127 Go</span><span class="sxs-lookup"><span data-stu-id="26d6c-605">1 x 127-GB hard disk</span></span> <br/>  <span data-ttu-id="26d6c-606">1 disque dur de 135 Go</span><span class="sxs-lookup"><span data-stu-id="26d6c-606">1 x 135-GB hard disk</span></span> <br/>  <span data-ttu-id="26d6c-607">1 disque dur de 127 Go</span><span class="sxs-lookup"><span data-stu-id="26d6c-607">1 x 127-GB hard disk</span></span> <br/>  <span data-ttu-id="26d6c-608">1 disque dur de 150 Go</span><span class="sxs-lookup"><span data-stu-id="26d6c-608">1 x 150-GB hard disk</span></span> <br/> |<span data-ttu-id="26d6c-609">sp-databaseservers</span><span class="sxs-lookup"><span data-stu-id="26d6c-609">sp-databaseservers</span></span>  <br/> |<span data-ttu-id="26d6c-610">DATA_SET</span><span class="sxs-lookup"><span data-stu-id="26d6c-610">DATA_SET</span></span>  <br/> |
|<span data-ttu-id="26d6c-611">AZ-WFE1, AZ -WFE2</span><span class="sxs-lookup"><span data-stu-id="26d6c-611">AZ-WFE1, AZ -WFE2</span></span>  <br/> |<span data-ttu-id="26d6c-612">Serveurs web frontaux</span><span class="sxs-lookup"><span data-stu-id="26d6c-612">Front End Web servers</span></span>  <br/> | <span data-ttu-id="26d6c-613">Configuration A5 :</span><span class="sxs-lookup"><span data-stu-id="26d6c-613">A5 configuration:</span></span> <br/>  <span data-ttu-id="26d6c-614">Deux processeurs</span><span class="sxs-lookup"><span data-stu-id="26d6c-614">Two processors</span></span> <br/>  <span data-ttu-id="26d6c-615">14 Go de RAM</span><span class="sxs-lookup"><span data-stu-id="26d6c-615">14 GB of RAM</span></span> <br/>  <span data-ttu-id="26d6c-616">1 disque dur de 127 Go</span><span class="sxs-lookup"><span data-stu-id="26d6c-616">1 x 127-GB hard disk</span></span> <br/> |<span data-ttu-id="26d6c-617">sp-webservers</span><span class="sxs-lookup"><span data-stu-id="26d6c-617">sp-webservers</span></span>  <br/> |<span data-ttu-id="26d6c-618">WFE_SET</span><span class="sxs-lookup"><span data-stu-id="26d6c-618">WFE_SET</span></span>  <br/> |
|<span data-ttu-id="26d6c-619">AZ -APP1, AZ -APP2, AZ -APP3</span><span class="sxs-lookup"><span data-stu-id="26d6c-619">AZ -APP1, AZ -APP2, AZ -APP3</span></span>  <br/> |<span data-ttu-id="26d6c-620">Serveurs d’applications</span><span class="sxs-lookup"><span data-stu-id="26d6c-620">Application servers</span></span>  <br/> | <span data-ttu-id="26d6c-621">Configuration A5 :</span><span class="sxs-lookup"><span data-stu-id="26d6c-621">A5 configuration:</span></span> <br/>  <span data-ttu-id="26d6c-622">Deux processeurs</span><span class="sxs-lookup"><span data-stu-id="26d6c-622">Two processors</span></span> <br/>  <span data-ttu-id="26d6c-623">14 Go de RAM</span><span class="sxs-lookup"><span data-stu-id="26d6c-623">14 GB of RAM</span></span> <br/>  <span data-ttu-id="26d6c-624">1 disque dur de 127 Go</span><span class="sxs-lookup"><span data-stu-id="26d6c-624">1 x 127-GB hard disk</span></span> <br/> |<span data-ttu-id="26d6c-625">sp-applicationservers</span><span class="sxs-lookup"><span data-stu-id="26d6c-625">sp-applicationservers</span></span>  <br/> |<span data-ttu-id="26d6c-626">APP_SET</span><span class="sxs-lookup"><span data-stu-id="26d6c-626">APP_SET</span></span>  <br/> |
|<span data-ttu-id="26d6c-627">AZ -SQL-HA1, AZ -SQL-HA2</span><span class="sxs-lookup"><span data-stu-id="26d6c-627">AZ -SQL-HA1, AZ -SQL-HA2</span></span>  <br/> |<span data-ttu-id="26d6c-628">Serveurs de base de données et réplicas principal et secondaire pour les groupes de disponibilité AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="26d6c-628">Database servers and primary and secondary replicas for AlwaysOn availability groups</span></span>  <br/> | <span data-ttu-id="26d6c-629">Configuration A5 :</span><span class="sxs-lookup"><span data-stu-id="26d6c-629">A5 configuration:</span></span> <br/>  <span data-ttu-id="26d6c-630">Deux processeurs</span><span class="sxs-lookup"><span data-stu-id="26d6c-630">Two processors</span></span> <br/>  <span data-ttu-id="26d6c-631">14 Go de RAM</span><span class="sxs-lookup"><span data-stu-id="26d6c-631">14 GB of RAM</span></span> <br/> |<span data-ttu-id="26d6c-632">sp-databaseservers</span><span class="sxs-lookup"><span data-stu-id="26d6c-632">sp-databaseservers</span></span>  <br/> |<span data-ttu-id="26d6c-633">DATA_SET</span><span class="sxs-lookup"><span data-stu-id="26d6c-633">DATA_SET</span></span>  <br/> |
   
### <a name="operations"></a><span data-ttu-id="26d6c-634">Opérations</span><span class="sxs-lookup"><span data-stu-id="26d6c-634">Operations</span></span>

<span data-ttu-id="26d6c-635">Après avoir stabilisé les environnements de batterie de serveurs et terminé les tests fonctionnels, l’équipe de test a démarré les tâches d’opérations suivantes, requises pour configurer l’environnement de récupération local :</span><span class="sxs-lookup"><span data-stu-id="26d6c-635">After the test team stabilized the farm environments and completed functional testing, they started the following operations tasks required to configure the on-premises recovery environment:</span></span>
  
- <span data-ttu-id="26d6c-636">Configuration des sauvegardes complètes et différentielles</span><span class="sxs-lookup"><span data-stu-id="26d6c-636">Configure full and differential backups.</span></span>
    
- <span data-ttu-id="26d6c-637">Configuration de la réplication DFS sur les serveurs de fichiers qui transfèrent les journaux des transactions entre l'environnement local et l'environnement Azure</span><span class="sxs-lookup"><span data-stu-id="26d6c-637">Configure DFSR on the file servers that transfer transaction logs between the on-premises environment and the Azure environment.</span></span>
    
- <span data-ttu-id="26d6c-638">Configuration des journaux des transactions sur le serveur de la base de données principale</span><span class="sxs-lookup"><span data-stu-id="26d6c-638">Configure log shipping on the primary database server.</span></span>
    
- <span data-ttu-id="26d6c-p176">Stabilisation, validation et résolution des problèmes de copie des journaux de transaction, le cas échéant, y compris l’identification et la consignation de tout comportement pouvant engendrer des problèmes, tel que la latence du réseau, susceptibles de provoquer l’échec de la copie des journaux de transaction ou de la synchronisation des fichiers de réplication DFS</span><span class="sxs-lookup"><span data-stu-id="26d6c-p176">Stabilize, validate, and troubleshoot log shipping, as required. This included identifying and documenting any behavior that might cause issues, such as network latency, which would cause log shipping or DFSR file synchronization failures.</span></span>
    
### <a name="databases"></a><span data-ttu-id="26d6c-641">Bases de données</span><span class="sxs-lookup"><span data-stu-id="26d6c-641">Databases</span></span>

<span data-ttu-id="26d6c-642">Nos tests de basculement ont été effectués avec les bases de données suivantes :</span><span class="sxs-lookup"><span data-stu-id="26d6c-642">Our failover tests involved the following databases:</span></span> 
  
- <span data-ttu-id="26d6c-643">WSS_Content</span><span class="sxs-lookup"><span data-stu-id="26d6c-643">WSS_Content</span></span>
    
- <span data-ttu-id="26d6c-644">ManagedMetadata</span><span class="sxs-lookup"><span data-stu-id="26d6c-644">ManagedMetadata</span></span>
    
- <span data-ttu-id="26d6c-645">Base de données de profils</span><span class="sxs-lookup"><span data-stu-id="26d6c-645">Profile DB</span></span>
    
- <span data-ttu-id="26d6c-646">Base de données de synchronisation</span><span class="sxs-lookup"><span data-stu-id="26d6c-646">Sync DB</span></span>
    
- <span data-ttu-id="26d6c-647">Base de données sociale</span><span class="sxs-lookup"><span data-stu-id="26d6c-647">Social DB</span></span>
    
- <span data-ttu-id="26d6c-648">Concentrateur de type de contenu (base de données pour concentrateur de syndication de type de contenu dédié)</span><span class="sxs-lookup"><span data-stu-id="26d6c-648">Content Type Hub (a database for a dedicated Content Type Syndication Hub)</span></span>
    
## <a name="troubleshooting-tips"></a><span data-ttu-id="26d6c-649">Conseils de dépannage</span><span class="sxs-lookup"><span data-stu-id="26d6c-649">Troubleshooting tips</span></span>

<span data-ttu-id="26d6c-650">Cette section décrit les problèmes rencontrés lors de nos tests et leurs solutions.</span><span class="sxs-lookup"><span data-stu-id="26d6c-650">The section explains the problems we encountered during our testing and their solutions.</span></span> 
  
### <a name="using-the-term-store-management-tool-caused-the-error-the-managed-metadata-store-or-connection-is-currently-not-available"></a><span data-ttu-id="26d6c-651">L'utilisation de l'outil de gestion du magasin de termes a provoqué une erreur. Le message d'erreur indique que le magasin de métadonnées gérées ou la connexion n'est pas disponible actuellement.</span><span class="sxs-lookup"><span data-stu-id="26d6c-651">Using the Term Store Management Tool caused the error, "The Managed Metadata Store or Connection is currently not available."</span></span>

<span data-ttu-id="26d6c-652">Vérifiez que le compte de pool d’applications utilisé par l’application web dispose de l’autorisation Magasin de termes avec accès en lecture.</span><span class="sxs-lookup"><span data-stu-id="26d6c-652">Ensure that the application pool account used by the web application has the Read Access to Term Store permission.</span></span>
  
### <a name="custom-term-sets-are-not-available-in-the-site-collection"></a><span data-ttu-id="26d6c-653">Les ensembles de termes personnalisés ne sont pas disponibles dans la collection de sites</span><span class="sxs-lookup"><span data-stu-id="26d6c-653">Custom term sets are not available in the site collection</span></span>

<span data-ttu-id="26d6c-p177">Recherchez une association d'application de service manquante entre votre collection de sites de contenu et votre concentrateur de type de contenu. En outre, dans l'écran de propriétés **Métadonnées gérées - Connexion à <site collection name>**, vérifiez que l'option suivante est activée : **Cette application de service est l'emplacement de stockage par défaut des ensembles de termes spécifiques des colonnes.**</span><span class="sxs-lookup"><span data-stu-id="26d6c-p177">Check for a missing service application association between your content site collection and your content type hub. In addition, under the **Managed Metadata - <site collection name> Connection** properties screen, make sure this option is enabled: **This service application is the default storage location for column specific term sets.**</span></span>
  
### <a name="the-get-adforest-windows-powershell-command-generates-the-error-the-term-get-adforest-is-not-recognized-as-the-name-of-a-cmdlet-function-script-file-or-operable-program"></a><span data-ttu-id="26d6c-656">La commande Windows PowerShell Get-ADForest génère une erreur indiquant que le terme Get-ADForest n'est pas reconnu comme le nom de la cmdlet, de la fonction, du fichier de script ou d'un programme exécutable.</span><span class="sxs-lookup"><span data-stu-id="26d6c-656">The Get-ADForest Windows PowerShell command generates the error, "The term 'Get-ADForest' is not recognized as the name of a cmdlet, function, script file, or operable program."</span></span>

<span data-ttu-id="26d6c-p178">Lorsque vous configurez les profils utilisateur, vous avez besoin du nom de la forêt Active Directory. Dans l'Assistant Ajout de rôles et de fonctionnalités, vérifiez que vous avez activé le module Active Directory pour Windows PowerShell (dans la section **Outils d'administration de serveur distant > Outils d'administration de rôles > Outils AD DS et AD LDS**). En outre, exécutez les commandes suivantes avant d'utiliser **Get-ADForest** pour vous assurer que vos dépendances logicielles sont chargées.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p178">When setting up user profiles, you need the Active Directory forest name. In the Add Roles and Features Wizard, ensure that you have enabled the Active Directory Module for Windows PowerShell (under the **Remote Server Administration Tools>Role Administration Tools>AD DS and AD LDS Tools** section). In addition, run the following commands before using **Get-ADForest** to help ensure that your software dependencies are loaded.</span></span>
  
```
Import-module servermanager
Import-module activedirectory

```

### <a name="availability-group-creation-fails-at-starting-the-alwayson_health-xevent-session-on-server-name"></a><span data-ttu-id="26d6c-660">Échec de la création du groupe de disponibilité au démarrage de la session XEvent « AlwaysOn_health » sur « <server name> »</span><span class="sxs-lookup"><span data-stu-id="26d6c-660">Availability group creation fails at Starting the 'AlwaysOn_health' XEvent session on '<server name>'</span></span>

<span data-ttu-id="26d6c-661">Veillez à ce que l'état des deux nœuds de votre cluster de basculement soit « En cours » et non « En pause » ou « Arrêté ».</span><span class="sxs-lookup"><span data-stu-id="26d6c-661">Ensure that both nodes of your failover cluster are in the Status "Up" and not "Paused" or "Stopped".</span></span> 
  
### <a name="sql-server-log-shipping-job-fails-with-access-denied-error-trying-to-connect-to-the-file-share"></a><span data-ttu-id="26d6c-662">Échec du travail de copie des journaux SQL Server et accès refusé lors de la tentative de connexion au partage de fichiers</span><span class="sxs-lookup"><span data-stu-id="26d6c-662">SQL Server log shipping job fails with access denied error trying to connect to the file share</span></span>

<span data-ttu-id="26d6c-663">Assurez-vous que votre agent SQL Server est exécuté avec les informations d’identification réseau, et non les informations d’identification par défaut.</span><span class="sxs-lookup"><span data-stu-id="26d6c-663">Ensure that your SQL Server Agent is running under network credentials, instead of the default credentials.</span></span>
  
### <a name="sql-server-log-shipping-job-indicates-success-but-no-files-are-copied"></a><span data-ttu-id="26d6c-664">Travail de copie des journaux SQL Server réussi, mais aucun fichier n’a été copié</span><span class="sxs-lookup"><span data-stu-id="26d6c-664">SQL Server log shipping job indicates success, but no files are copied</span></span>

<span data-ttu-id="26d6c-p179">Ce problème survient lorsque les préférences de sauvegarde par défaut pour un groupe de disponibilité sont définies sur **Préférer le réplica secondaire**. Veillez à exécuter la copie des journaux à partir du serveur secondaire pour le groupe de disponibilité et non à partir du serveur principal, sous peine d'échec silencieux du travail.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p179">This happens because the default backup preference for an availability group is **Prefer Secondary**. Ensure that you run the log shipping job from the secondary server for the availability group instead of the primary; otherwise, the job will fail silently.</span></span> 
  
### <a name="managed-metadata-service-or-other-sharepoint-service-fails-to-start-automatically-after-installation"></a><span data-ttu-id="26d6c-667">Le service de métadonnées gérées (ou un autre service SharePoint) ne démarre pas automatiquement après l’installation</span><span class="sxs-lookup"><span data-stu-id="26d6c-667">Managed Metadata service (or other SharePoint service) fails to start automatically after installation</span></span>

<span data-ttu-id="26d6c-668">Les services peuvent mettre plusieurs minutes à démarrer, selon les performances et la charge actuelle de votre serveur SharePoint.</span><span class="sxs-lookup"><span data-stu-id="26d6c-668">Services might take several minutes to start, depending on the performance and current load of your SharePoint Server.</span></span> <span data-ttu-id="26d6c-669">Cliquez sur le bouton **Démarrer** pour le service concerné et accordez suffisamment de temps au démarrage, tout en actualisant de temps à autre les services sur l'écran du serveur pour contrôler son état.</span><span class="sxs-lookup"><span data-stu-id="26d6c-669">Manually click **Start** for the service and provide adequate time for startup while occasionally refreshing the Services on Server screen to monitor its status.</span></span> <span data-ttu-id="26d6c-670">Si le service est encore arrêté, activez la journalisation des diagnostics SharePoint, essayez de redémarrer le service et vérifiez si le journal contient des erreurs.</span><span class="sxs-lookup"><span data-stu-id="26d6c-670">In case the service remains stopped, enable SharePoint diagnostic logging, attempt to start the service again, and then check the log for errors.</span></span> <span data-ttu-id="26d6c-671">Pour plus d’informations, voir [Configure diagnostic logging in SharePoint 2013](/sharepoint/administration/configure-diagnostic-logging)</span><span class="sxs-lookup"><span data-stu-id="26d6c-671">For more information, see [Configure diagnostic logging in SharePoint 2013](/sharepoint/administration/configure-diagnostic-logging)</span></span>
  
### <a name="after-changing-dns-to-the-azure-failover-environment-client-browsers-continue-to-use-the-old-ip-address-for-the-sharepoint-site"></a><span data-ttu-id="26d6c-672">Après avoir modifié le service DNS sur l’environnement de basculement Azure, les navigateurs clients continuent à utiliser l’ancienne adresse IP pour le site SharePoint</span><span class="sxs-lookup"><span data-stu-id="26d6c-672">After changing DNS to the Azure failover environment, client browsers continue to use the old IP address for the SharePoint site</span></span>

<span data-ttu-id="26d6c-p181">Il se peut que la modification de votre DNS ne soit pas immédiatement visible pour tous les clients. Sur un client test, exécutez la commande suivante dans une invite de commandes avec élévation de privilèges et tentez d’accéder de nouveau au site.</span><span class="sxs-lookup"><span data-stu-id="26d6c-p181">Your DNS change might not be visible to all clients immediately. On a test client, perform the following command from an elevated command prompt and attempt to access the site again.</span></span>
  
```
Ipconfig /flushdns
```

## <a name="additional-resources"></a><span data-ttu-id="26d6c-675">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="26d6c-675">Additional resources</span></span>

[<span data-ttu-id="26d6c-676">Options de haute disponibilité et de récupération d'urgence prises en charge pour les bases de données SharePoint</span><span class="sxs-lookup"><span data-stu-id="26d6c-676">Supported high availability and disaster recovery options for SharePoint databases</span></span>](/sharepoint/administration/supported-high-availability-and-disaster-recovery-options-for-sharepoint-databas)
  
[<span data-ttu-id="26d6c-677">Configurer des groupes de disponibilité AlwaysOn SQL Server 2012 pour SharePoint 2013</span><span class="sxs-lookup"><span data-stu-id="26d6c-677">Configure SQL Server 2012 AlwaysOn Availability Groups for SharePoint 2013</span></span>](/SharePoint/administration/configure-an-alwayson-availability-group)
  
## <a name="see-also"></a><span data-ttu-id="26d6c-678">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="26d6c-678">See Also</span></span>

[<span data-ttu-id="26d6c-679">Centre de solutions et d'architecture Microsoft 365</span><span class="sxs-lookup"><span data-stu-id="26d6c-679">Microsoft 365 solution and architecture center</span></span>](../solutions/index.yml)